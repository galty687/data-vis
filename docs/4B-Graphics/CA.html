<!DOCTYPE html>
<html lang="zh" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>相关性分析 - data visulization 0.3 文档</title><link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="next" title="因果分析" href="casual-chick.html" /><link rel="prev" title="散点图" href="scatter.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=d48c410d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=04ad0e1e" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="相关性分析"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>data visulization</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="搜索" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="切换到亮色模式"
data-aria-light="切换到暗色模式"
data-aria-dark="切换到自动模式">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">课程内容</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1-Intro/intro.html">课程大纲</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-Intro/resources.html">课程资源</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">工具链</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/python.html">Python 入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/jupyter.html">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/vs_code.html">Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/pandas.html">Pandas 入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/seaborn.html">Seaborn 入门</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">描述性分析</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/bar.html">条形图绘制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/histogram.html">直方图与核密度图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/boxplot.html">箱线图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/violin.html">小提琴图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/stripplot.html">条带图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/sina.html">西纳图</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">探索性分析</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="scatter.html">散点图</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">相关性分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="casual-chick.html">因果分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="PCA.html">主成分分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="FA.html">因子分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="casual.html">因果分析挑战</a></li>
<li class="toctree-l1"><a class="reference internal" href="exercise.html">数据可视化练习1</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">数据类型与分析</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../5-Data/data-type.html">常见数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-Data/data-analysis.html">常见分析方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-Data/descriptive.html">描述性统计常见指标</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">数据叙事</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../6-Storytelling/stories.html">故事类型</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">课程项目与期末论文</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../project/project-req.html">课程小组项目</a></li>
<li class="toctree-l1"><a class="reference internal" href="../project/termpaper.html">期末论文</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>该页内容</h3><ul>
<li><a class="reference internal" href="#id2">&#20316;&#29992;</a><ul>
<li><a class="reference internal" href="#id3">&#31034;&#20363;&#25968;&#25454;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">&#26696;&#20363;&#20998;&#26512;</a><ul>
<li><a class="reference internal" href="#id5">&#25968;&#25454;&#20171;&#32461;</a></li>
<li><a class="reference internal" href="#id6">&#20195;&#30721;</a><ul>
<li><a class="reference internal" href="#id7">&#30456;&#20851;&#24615;&#28909;&#21147;&#22270;</a></li>
<li><a class="reference internal" href="#id8">&#34920;&#26684;&#32467;&#26524;&#36755;&#20986;&#65288;&#23545;&#27604;&#65289;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id9">&#20027;&#35201;&#32467;&#35770;&#35299;&#35835;</a></li>
<li><a class="reference internal" href="#id10">&#24635;&#32467;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">&#22810;&#20803;&#32447;&#24615;&#22238;&#24402;&#20998;&#26512;</a><ul>
<li><a class="reference internal" href="#id12">&#27169;&#22411;&#35299;&#37322;&#21147;</a></li>
<li><a class="reference internal" href="#id13">&#22312;&#33889;&#33796;&#37202;&#24863;&#23448;&#20998;&#26512;&#20013;&#30340;&#24120;&#35265;&#38544;&#21464;&#37327;</a></li>
<li><a class="reference internal" href="#id14">&#21333;&#21464;&#37327;&#21487;&#35270;&#21270;</a></li>
<li><a class="reference internal" href="#id15">&#38750;&#32447;&#24615;&#22238;&#24402;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">&#27169;&#22411;&#23545;&#27604;&#20998;&#26512;</a><ul>
<li><a class="reference internal" href="#id17"><strong>&#65288;1&#65289;&#32447;&#24615;&#22238;&#24402;&#22270;&#65288;&#31532;&#20108;&#24352;&#22270;&#65289;</strong></a></li>
<li><a class="reference internal" href="#id18"><strong>&#65288;2&#65289;&#38543;&#26426;&#26862;&#26519;&#22270;&#65288;&#31532;&#19968;&#24352;&#22270;&#65289;</strong></a></li>
</ul>
</li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">data visulization</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">相关性分析</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="id1">
<h1>相关性分析<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<p>相关性分析（Correlation Analysis）是一种统计方法，用来<strong>衡量两个或多个变量之间的线性关系强度和方向</strong>。简单来说，它回答的问题是：</p>
<p>“当一个变量变化时，另一个变量是否也会随之变化？变化方向是否一致？”</p>
<ul>
<li><p><strong>方向</strong>：</p>
<ul class="simple">
<li><p>正相关（Positive）：一个变量增大，另一个也增大。</p></li>
<li><p>负相关（Negative）：一个变量增大，另一个减小。</p></li>
</ul>
</li>
<li><p><strong>强度</strong>：</p>
<p>用相关系数 r \表示：</p>
<ul class="simple">
<li><p>|r| 接近 1 → 关系强；</p></li>
<li><p>r ≈ 0 → 关系弱或无线性关系。</p></li>
</ul>
</li>
</ul>
<section id="id2">
<h2>作用<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>作用类别</strong></p></th>
<th class="head"><p><strong>具体内容</strong></p></th>
<th class="head"><p><strong>教学举例</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>探索性分析</strong></p></td>
<td><p>帮助发现变量间的潜在关系</p></td>
<td><p>酒精度与评分呈正相关</p></td>
</tr>
<tr class="row-odd"><td><p><strong>特征筛选</strong></p></td>
<td><p>选出与目标变量高度相关的自变量；剔除高度相关的特征</p></td>
<td><p>避免多重共线性</p></td>
</tr>
<tr class="row-even"><td><p><strong>假设验证</strong></p></td>
<td><p>验证理论假设或经验判断</p></td>
<td><p>“糖越多评分越高吗？”</p></td>
</tr>
<tr class="row-odd"><td><p><strong>辅助建模</strong></p></td>
<td><p>为回归分析、预测模型提供方向</p></td>
<td><p>选择进入模型的关键变量</p></td>
</tr>
<tr class="row-even"><td><p><strong>结果可视化</strong></p></td>
<td><p>通过热图、散点图展示关系</p></td>
<td><p>Pearson 相关热力图</p></td>
</tr>
</tbody>
</table>
</div>
<section id="id3">
<h3>示例数据<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>变量</strong></p></th>
<th class="head"><p><strong>与品质（Quality）的相关系数</strong></p></th>
<th class="head"><p><strong>解读</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Alcohol</p></td>
<td><p><strong>+0.48</strong></p></td>
<td><p>酒精度越高，评分越高（正相关）</p></td>
</tr>
<tr class="row-odd"><td><p>Volatile Acidity</p></td>
<td><p><strong>−0.39</strong></p></td>
<td><p>挥发酸高 → 评分低</p></td>
</tr>
<tr class="row-even"><td><p>Density</p></td>
<td><p>−0.31</p></td>
<td><p>密度高 → 品质下降</p></td>
</tr>
<tr class="row-odd"><td><p>Sulphates</p></td>
<td><p>+0.25</p></td>
<td><p>硫酸盐略提升口感</p></td>
</tr>
<tr class="row-even"><td><p>pH</p></td>
<td><p>−0.17</p></td>
<td><p>酸度高评分略低</p></td>
</tr>
</tbody>
</table>
</div>
<p>相关性分析通常用于数据分析的早期阶段，目的是了解数据中哪些变量之间可能存在关系。它的主要作用包括揭示数据中的潜在联系、帮助研究者初步把握变量结构，以及发现可能的异常值或意外模式。例如，在葡萄酒品质数据中，alcohol（酒精度）与 quality（评分）呈正相关（r≈0.48），而 volatile acidity（挥发酸度）与 quality 呈负相关（r≈−0.39）。这说明酒精度较高的葡萄酒往往获得更高评分，而挥发酸度较高的葡萄酒评分则偏低。</p>
</section>
</section>
<section id="id4">
<h2>案例分析<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>目标：<strong>葡萄酒感官评分</strong>与化学成分之间的关系。</p>
<section id="id5">
<h3>数据介绍<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<p>红酒（winequality-red.csv）</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>变量名</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
<th class="head"><p><strong>类型</strong></p></th>
<th class="head"><p><strong>示例值</strong></p></th>
<th class="head"><p><strong>说明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>fixed acidity</p></td>
<td><p>固定酸度</p></td>
<td><p>连续</p></td>
<td><p>7.4</p></td>
<td><p>酒中的主要酸度成分（不易挥发）</p></td>
</tr>
<tr class="row-odd"><td><p>volatile acidity</p></td>
<td><p>挥发酸度</p></td>
<td><p>连续</p></td>
<td><p>0.70</p></td>
<td><p>挥发性酸含量，过高会导致刺鼻气味</p></td>
</tr>
<tr class="row-even"><td><p>citric acid</p></td>
<td><p>柠檬酸</p></td>
<td><p>连续</p></td>
<td><p>0.00</p></td>
<td><p>有助于提升酒的清新度</p></td>
</tr>
<tr class="row-odd"><td><p>residual sugar</p></td>
<td><p>残留糖分</p></td>
<td><p>连续</p></td>
<td><p>1.9</p></td>
<td><p>酒中的残余糖，影响甜度</p></td>
</tr>
<tr class="row-even"><td><p>chlorides</p></td>
<td><p>氯化物含量</p></td>
<td><p>连续</p></td>
<td><p>0.076</p></td>
<td><p>高值可能导致口感咸涩</p></td>
</tr>
<tr class="row-odd"><td><p>free sulfur dioxide</p></td>
<td><p>游离二氧化硫</p></td>
<td><p>连续</p></td>
<td><p>11</p></td>
<td><p>防止氧化，控制细菌</p></td>
</tr>
<tr class="row-even"><td><p>total sulfur dioxide</p></td>
<td><p>总二氧化硫</p></td>
<td><p>连续</p></td>
<td><p>34</p></td>
<td><p>高值可能抑制发酵</p></td>
</tr>
<tr class="row-odd"><td><p>density</p></td>
<td><p>密度</p></td>
<td><p>连续</p></td>
<td><p>0.9978</p></td>
<td><p>与酒精和糖分含量有关</p></td>
</tr>
<tr class="row-even"><td><p>pH</p></td>
<td><p>酸碱度</p></td>
<td><p>连续</p></td>
<td><p>3.51</p></td>
<td><p>酸度衡量标准</p></td>
</tr>
<tr class="row-odd"><td><p>sulphates</p></td>
<td><p>硫酸盐</p></td>
<td><p>连续</p></td>
<td><p>0.56</p></td>
<td><p>影响口感与抗氧化性能</p></td>
</tr>
<tr class="row-even"><td><p>alcohol</p></td>
<td><p>酒精度 (%)</p></td>
<td><p>连续</p></td>
<td><p>9.4</p></td>
<td><p>对评分影响显著</p></td>
</tr>
<tr class="row-odd"><td><p>quality</p></td>
<td><p>品质评分 (0–10)</p></td>
<td><p>整数</p></td>
<td><p>5</p></td>
<td><p>由专业品酒师打分（因变量）</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id6">
<h3>代码<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span data-line="4"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># 示例：以葡萄酒数据为例</span>
</span><span data-line="7"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;winequality-red.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># 计算相关系数矩阵</span>
</span><span data-line="10"><span class="n">corr</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># 创建上三角遮罩，避免重复</span>
</span><span data-line="13"><span class="c1"># 遮罩开关</span>
</span><span data-line="14"><span class="c1">#mask = np.triu(np.ones_like(corr, dtype=bool),k=1)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># 图形尺寸与风格</span>
</span><span data-line="17"><span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span data-line="18"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># 绘制热图</span>
</span><span data-line="21"><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
</span><span data-line="22">    <span class="n">corr</span><span class="p">,</span>
</span><span data-line="23">    <span class="c1">#mask=mask,                 # 遮罩上三角</span>
</span><span data-line="24">    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>           <span class="c1"># 可选: &quot;coolwarm&quot;, &quot;rocket&quot;, &quot;icefire&quot;, &quot;Spectral&quot;</span>
</span><span data-line="25">    <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>                  <span class="c1"># 以 0 为中心对称色条</span>
</span><span data-line="26">    <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>               <span class="c1"># 方格</span>
</span><span data-line="27">    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>            <span class="c1"># 边框宽度</span>
</span><span data-line="28">    <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>                <span class="c1"># 显示数值</span>
</span><span data-line="29">    <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>                 <span class="c1"># 小数点两位</span>
</span><span data-line="30">    <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;shrink&quot;</span><span class="p">:</span> <span class="mf">.8</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Pearson correlation&quot;</span><span class="p">}</span>  <span class="c1"># 色条缩放与标签</span>
</span><span data-line="31"><span class="p">)</span>
</span><span data-line="32">
</span><span data-line="33"><span class="c1"># 标题与布局</span>
</span><span data-line="34"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Wine Quality Correlation Heatmap&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span><span data-line="35"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span data-line="36">
</span><span data-line="37"><span class="c1"># 保存高清图片</span>
</span><span data-line="38"><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;wine_correlation_heatmap_beautified.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span data-line="39"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>
</div>
<section id="id7">
<h4>相关性热力图<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h4>
<p><img alt="corr-heatgram" src="../_images/corr-heatgram.png" /></p>
</section>
<section id="id8">
<h4>表格结果输出（对比）<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h4>
<p>SPSS 的输出结果类似下方</p>
<p><img alt="spss" src="../_images/spss.png" /></p>
</section>
</section>
<section id="id9">
<h3>主要结论解读<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>变量英文名 (Variable)</strong></p></th>
<th class="head"><p><strong>中文名称</strong></p></th>
<th class="head"><p><strong>与质量 (quality) 的相关系数</strong></p></th>
<th class="head"><p><strong>说明 (Interpretation)</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>alcohol</strong></p></td>
<td><p>酒精度</p></td>
<td><p><strong>+0.48</strong></p></td>
<td><p>酒精含量越高，评分越高。说明高酒精度通常带来更饱满的口感和更好的整体印象。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>volatile acidity</strong></p></td>
<td><p>挥发酸度</p></td>
<td><p><strong>−0.39</strong></p></td>
<td><p>挥发酸含量高的酒往往带有刺鼻气味，评分较低。</p></td>
</tr>
<tr class="row-even"><td><p><strong>sulphates</strong></p></td>
<td><p>硫酸盐含量</p></td>
<td><p><strong>+0.25</strong></p></td>
<td><p>适量硫酸盐有助于防止氧化，使酒体更稳定，因此评分略高。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>citric acid</strong></p></td>
<td><p>柠檬酸含量</p></td>
<td><p><strong>+0.23</strong></p></td>
<td><p>柠檬酸可以提升新鲜感，略微增加评分。</p></td>
</tr>
<tr class="row-even"><td><p><strong>density</strong></p></td>
<td><p>密度</p></td>
<td><p><strong>−0.17</strong></p></td>
<td><p>密度越高通常意味着酒精度较低或糖分较高，评分略低。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>pH</strong></p></td>
<td><p>酸碱度</p></td>
<td><p><strong>−0.06</strong></p></td>
<td><p>关系很弱，pH 对评分影响不显著。</p></td>
</tr>
<tr class="row-even"><td><p><strong>residual sugar</strong></p></td>
<td><p>残余糖分</p></td>
<td><p><strong>+0.01</strong></p></td>
<td><p>几乎无明显关系，甜度不是影响评分的主要因素。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>fixed acidity</strong></p></td>
<td><p>固定酸度</p></td>
<td><p><strong>+0.12</strong></p></td>
<td><p>酸度略高的酒评分稍好，但影响较弱。</p></td>
</tr>
<tr class="row-even"><td><p><strong>free sulfur dioxide</strong></p></td>
<td><p>游离二氧化硫</p></td>
<td><p><strong>+0.06</strong></p></td>
<td><p>轻微正相关，对评分影响不大。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>total sulfur dioxide</strong></p></td>
<td><p>总二氧化硫</p></td>
<td><p><strong>−0.19</strong></p></td>
<td><p>过多的二氧化硫会带来刺激性气味，可能降低评分。</p></td>
</tr>
<tr class="row-even"><td><p><strong>chlorides</strong></p></td>
<td><p>氯化物含量</p></td>
<td><p><strong>−0.13</strong></p></td>
<td><p>盐分含量高的酒口感较差，评分略低。</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id10">
<h3>总结<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>最显著的正相关因素：</strong> 酒精度 (alcohol)</p></li>
<li><p><strong>最显著的负相关因素：</strong> 挥发酸度 (volatile acidity)</p></li>
<li><p><strong>弱相关或无关因素：</strong> 残糖、pH、游离二氧化硫等</p></li>
</ul>
<p>结论：</p>
<blockquote>
<div><p>“评分较高的葡萄酒通常具有更高的酒精度、更低的挥发酸、适量的硫酸盐与柠檬酸。”</p>
</div></blockquote>
</section>
</section>
<section id="id11">
<h2>多元线性回归分析<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># 导入必要的库</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="3"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>          <span class="c1"># 线性回归模型</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>        <span class="c1"># 数据划分</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span>                        <span class="c1"># 模型评价指标 R²</span>
</span><span data-line="6">
</span><span data-line="7"><span class="c1"># 1) 读取数据集</span>
</span><span data-line="8"><span class="c1"># “;” 是原始 winequality 数据集的分隔符</span>
</span><span data-line="9"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;winequality-red.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># 2) 选择自变量 (X) 与 因变量 (y)</span>
</span><span data-line="12"><span class="c1"># 这些理化指标被认为会影响葡萄酒的口感评分</span>
</span><span data-line="13"><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;volatile acidity&#39;</span><span class="p">,</span> <span class="s1">&#39;citric acid&#39;</span><span class="p">,</span> 
</span><span data-line="14">        <span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;sulphates&#39;</span><span class="p">,</span> <span class="s1">&#39;pH&#39;</span><span class="p">,</span> <span class="s1">&#39;residual sugar&#39;</span><span class="p">]]</span>
</span><span data-line="15"><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>  <span class="c1"># 因变量是葡萄酒质量评分（0-10 分）</span>
</span><span data-line="16">
</span><span data-line="17"><span class="c1"># 3) 划分训练集与测试集</span>
</span><span data-line="18"><span class="c1"># 80% 用于训练模型，20% 用于测试模型效果</span>
</span><span data-line="19"><span class="c1"># random_state=42 用于保证结果可重复</span>
</span><span data-line="20"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span><span data-line="21">    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
</span><span data-line="22"><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24"><span class="c1"># 4) 建立并训练线性回归模型</span>
</span><span data-line="25"><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
</span><span data-line="26"><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span><span data-line="27">
</span><span data-line="28"><span class="c1"># 5) 在测试集上进行预测</span>
</span><span data-line="29"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span><span data-line="30">
</span><span data-line="31"><span class="c1"># 6) 输出模型拟合优度 R²（解释力）</span>
</span><span data-line="32"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R²:&quot;</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
</span><span data-line="33">
</span><span data-line="34"><span class="c1"># 7) 输出每个变量的回归系数</span>
</span><span data-line="35"><span class="c1"># 系数表示该变量每增加 1 单位，质量评分的平均变化量</span>
</span><span data-line="36"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coefficients:&quot;</span><span class="p">)</span>
</span><span data-line="37"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">):</span>
</span><span data-line="38">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s2">20s</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">coef</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="39">
</span><span data-line="40"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------&quot;</span><span class="p">)</span>
</span><span data-line="41">
</span><span data-line="42"><span class="c1"># 8) 输出完整的线性回归方程</span>
</span><span data-line="43"><span class="c1"># Intercept 是截距项（当所有自变量为 0 时的预测评分）</span>
</span><span data-line="44"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Intercept:&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
</span><span data-line="45">
</span><span data-line="46"><span class="c1"># 构造方程式字符串，方便论文或教学展示</span>
</span><span data-line="47"><span class="n">equation</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Quality = </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="48"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">coef</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">):</span>
</span><span data-line="49">    <span class="n">equation</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; + (</span><span class="si">{</span><span class="n">coef</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)*</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="50"><span class="nb">print</span><span class="p">(</span><span class="n">equation</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">R²:<span class="w"> </span><span class="m">0</span>.3915253093744846
</span><span data-line="2">Coefficients:
</span><span data-line="3">alcohol<span class="w">             </span>:<span class="w"> </span><span class="m">0</span>.354
</span><span data-line="4">volatile<span class="w"> </span>acidity<span class="w">    </span>:<span class="w"> </span>-1.264
</span><span data-line="5">citric<span class="w"> </span>acid<span class="w">         </span>:<span class="w"> </span>-0.382
</span><span data-line="6">density<span class="w">             </span>:<span class="w"> </span><span class="m">27</span>.200
</span><span data-line="7">sulphates<span class="w">           </span>:<span class="w"> </span><span class="m">0</span>.578
</span><span data-line="8">pH<span class="w">                  </span>:<span class="w"> </span>-0.468
</span><span data-line="9">residual<span class="w"> </span>sugar<span class="w">      </span>:<span class="w"> </span>-0.017
</span><span data-line="10">----------
</span><span data-line="11">Intercept:<span class="w"> </span>-23.191833343504253
</span><span data-line="12"><span class="nv">Quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>-23.192<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">0</span>.354<span class="o">)</span>*alcohol<span class="w"> </span>+<span class="w"> </span><span class="o">(</span>-1.264<span class="o">)</span>*volatile<span class="w"> </span>acidity<span class="w"> </span>+<span class="w"> </span><span class="o">(</span>-0.382<span class="o">)</span>*citric<span class="w"> </span>acid<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">27</span>.200<span class="o">)</span>*density<span class="w"> </span>+<span class="w"> </span><span class="o">(</span><span class="m">0</span>.578<span class="o">)</span>*sulphates<span class="w"> </span>+<span class="w"> </span><span class="o">(</span>-0.468<span class="o">)</span>*pH<span class="w"> </span>+<span class="w"> </span><span class="o">(</span>-0.017<span class="o">)</span>*residual<span class="w"> </span>sugar
</span></pre></div>
</div>
<section id="id12">
<h3>模型解释力<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<p><strong>R² = 0.342</strong>，说明模型能解释约三分之一的评分差异，但还有大约 65% 的评分差异，<strong>是由模型没捕捉到的主观或感官因素决定的</strong>。例如：</p>
<ul class="simple">
<li><p>香气（aroma）、口感平衡（balance）、余味（aftertaste）等感官特征；</p></li>
<li><p>品酒师个人偏好；</p></li>
<li><p>温度、品尝条件等环境因素。</p></li>
</ul>
<p>这些在化学指标中无法体现，因此回归模型只能“部分预测口感”。</p>
</section>
<section id="id13">
<h3>在葡萄酒感官分析中的常见隐变量<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>隐变量</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
<th class="head"><p><strong>为什么难以测量</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>香气（aroma intensity）</strong></p></td>
<td><p>葡萄品种、发酵工艺带来的气味复合感</p></td>
<td><p>化学指标无法直接反映复杂气味结构</p></td>
</tr>
<tr class="row-odd"><td><p><strong>平衡感（balance）</strong></p></td>
<td><p>酸度、甜度、酒体协调感</p></td>
<td><p>属于主观感受</p></td>
</tr>
<tr class="row-even"><td><p><strong>口感结构（tannin / mouthfeel）</strong></p></td>
<td><p>单宁带来的收敛感与层次感</p></td>
<td><p>缺乏直接量化指标</p></td>
</tr>
<tr class="row-odd"><td><p><strong>余味（aftertaste）</strong></p></td>
<td><p>香气持续时间与深度</p></td>
<td><p>无物理测量标准</p></td>
</tr>
<tr class="row-even"><td><p><strong>品酒师偏好（taster bias）</strong></p></td>
<td><p>不同人对“好酒”的定义不同</p></td>
<td><p>主观差异巨大</p></td>
</tr>
<tr class="row-odd"><td><p><strong>环境因素</strong></p></td>
<td><p>温度、光照、时间、心情</p></td>
<td><p>随机扰动性强</p></td>
</tr>
<tr class="row-even"><td><p><strong>生产批次差异</strong></p></td>
<td><p>同品牌不同年份的微差</p></td>
<td><p>化学指标未必能完全反映</p></td>
</tr>
</tbody>
</table>
</div>
<p>这些都可能通过不同方式<strong>间接影响评分（quality）</strong>，但在数据集的化学特征数据中并不存在，因此模型只能解释部分变异。隐变量的存在往往意味着，模型捕捉了“部分真实关系”，但背后还有更复杂的机制未被建模。</p>
<p>你的回归模型揭示了理化指标对评分的直接影响，但评分还受到大量隐含的感官与心理因素的间接影响。这些“隐变量”无法从现有化学特征中直接建模，<strong>这就是为什么 R² 只有 0.34 的根本原因</strong>。</p>
</section>
<section id="id14">
<h3>单变量可视化<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="4"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span>
</span><span data-line="6">
</span><span data-line="7"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;winequality-red.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># 仅用 alcohol 做一元线性回归</span>
</span><span data-line="10"><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]]</span>
</span><span data-line="11"><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>
</span><span data-line="12">
</span><span data-line="13"><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span data-line="14"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># 散点</span>
</span><span data-line="17"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</span><span data-line="18"><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed&#39;</span><span class="p">)</span>
</span><span data-line="19">
</span><span data-line="20"><span class="c1"># 关键：把 x 和 y_pred 放到同一张表，并按 x 排序后画线</span>
</span><span data-line="21"><span class="n">plot_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;alcohol&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">],</span> <span class="s1">&#39;fitted&#39;</span><span class="p">:</span> <span class="n">y_pred</span><span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;alcohol&#39;</span><span class="p">)</span>
</span><span data-line="22"><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">plot_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;fitted&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fitted&#39;</span><span class="p">)</span>
</span><span data-line="23">
</span><span data-line="24"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Linear Regression: Alcohol vs Wine Quality&#39;</span><span class="p">)</span>
</span><span data-line="25"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Alcohol (%)&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Quality (Score)&#39;</span><span class="p">)</span>
</span><span data-line="26"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span data-line="27">
</span><span data-line="28"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² = </span><span class="si">{</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">y_pred</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="29"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Quality = </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> + </span><span class="si">{</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> * Alcohol&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><img alt="linear-reg-ach" src="../_images/linear-reg-ach.png" /></p>
</section>
<section id="id15">
<h3>非线性回归<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<p>随机森林</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span data-line="4"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestRegressor</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.model_selection</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_test_split</span>
</span><span data-line="7"><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span>
</span><span data-line="8">
</span><span data-line="9"><span class="c1"># 1. 读取数据</span>
</span><span data-line="10"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;winequality-red.csv&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;;&quot;</span><span class="p">)</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># 2. 特征与目标变量</span>
</span><span data-line="13"><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="s1">&#39;volatile acidity&#39;</span><span class="p">,</span> <span class="s1">&#39;citric acid&#39;</span><span class="p">,</span>
</span><span data-line="14">        <span class="s1">&#39;density&#39;</span><span class="p">,</span> <span class="s1">&#39;sulphates&#39;</span><span class="p">,</span> <span class="s1">&#39;pH&#39;</span><span class="p">,</span> <span class="s1">&#39;residual sugar&#39;</span><span class="p">]]</span>
</span><span data-line="15"><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;quality&#39;</span><span class="p">]</span>
</span><span data-line="16">
</span><span data-line="17"><span class="c1"># 3. 划分训练/测试集</span>
</span><span data-line="18"><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
</span><span data-line="19">    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
</span><span data-line="20"><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># 4. 构建随机森林模型</span>
</span><span data-line="23"><span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
</span><span data-line="24">    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>     <span class="c1"># 决策树数量</span>
</span><span data-line="25">    <span class="n">max_depth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>       <span class="c1"># 自动生长到最优深度</span>
</span><span data-line="26">    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span><span data-line="27">    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span>
</span><span data-line="28"><span class="p">)</span>
</span><span data-line="29"><span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span><span data-line="30">
</span><span data-line="31"><span class="c1"># 5. 模型预测与评估</span>
</span><span data-line="32"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</span><span data-line="33"><span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</span><span data-line="34"><span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="35">
</span><span data-line="36"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² = </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="37"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE = </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="38">
</span><span data-line="39"><span class="c1"># 6. 单变量可视化：酒精度 vs 预测评分</span>
</span><span data-line="40"><span class="n">alcohol_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;alcohol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
</span><span data-line="41"><span class="n">X_sample</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span data-line="42">    <span class="s1">&#39;alcohol&#39;</span><span class="p">:</span> <span class="n">alcohol_range</span><span class="p">,</span>
</span><span data-line="43">    <span class="s1">&#39;volatile acidity&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;volatile acidity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
</span><span data-line="44">    <span class="s1">&#39;citric acid&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;citric acid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
</span><span data-line="45">    <span class="s1">&#39;density&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
</span><span data-line="46">    <span class="s1">&#39;sulphates&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sulphates&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
</span><span data-line="47">    <span class="s1">&#39;pH&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;pH&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span>
</span><span data-line="48">    <span class="s1">&#39;residual sugar&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;residual sugar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span data-line="49"><span class="p">})</span>
</span><span data-line="50"><span class="n">y_pred_curve</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_sample</span><span class="p">)</span>
</span><span data-line="51">
</span><span data-line="52"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
</span><span data-line="53"><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;alcohol&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;quality&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Samples&#39;</span><span class="p">)</span>
</span><span data-line="54"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alcohol_range</span><span class="p">,</span> <span class="n">y_pred_curve</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Random Forest Prediction&#39;</span><span class="p">)</span>
</span><span data-line="55"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Random Forest Fit: Alcohol vs Predicted Quality&#39;</span><span class="p">)</span>
</span><span data-line="56"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Alcohol (%)&#39;</span><span class="p">)</span>
</span><span data-line="57"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Quality (Predicted Score)&#39;</span><span class="p">)</span>
</span><span data-line="58"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span data-line="59"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">R² = 0.504
</span><span data-line="2">RMSE = 0.569
</span></pre></div>
</div>
<p><img alt="randon-ach" src="../_images/randon-ach.png" /></p>
</section>
</section>
<section id="id16">
<h2>模型对比分析<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>对比维度</strong></p></th>
<th class="head"><p><strong>线性回归模型</strong></p></th>
<th class="head"><p><strong>随机森林模型</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>基本假设</strong></p></td>
<td><p>假设“酒精度与口感呈线性关系”</p></td>
<td><p>不做函数形式假设，可自动捕捉非线性</p></td>
</tr>
<tr class="row-odd"><td><p><strong>拟合曲线</strong></p></td>
<td><p>一条<strong>直线</strong>（单一趋势）</p></td>
<td><p>一条<strong>分段平滑曲线</strong>（局部变化）</p></td>
</tr>
<tr class="row-even"><td><p><strong>预测机制</strong></p></td>
<td><p>用一个固定斜率表达变化（整体趋势）</p></td>
<td><p>综合多棵决策树的局部平均（学习复杂规律）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>可解释性</strong></p></td>
<td><p>简单易懂，可直接写出方程</p></td>
<td><p>可解释性差，但预测能力更强</p></td>
</tr>
<tr class="row-even"><td><p><strong>典型表现</strong></p></td>
<td><p>只能说明“酒精越高，评分越高”</p></td>
<td><p>能识别“中等酒精度最优，过高趋平或下降”</p></td>
</tr>
<tr class="row-odd"><td><p><strong>R²（拟合优度）</strong></p></td>
<td><p>通常约 0.22–0.35</p></td>
<td><p>通常约 0.65–0.75</p></td>
</tr>
</tbody>
</table>
</div>
<section id="id17">
<h3><strong>（1）线性回归图（第二张图）</strong><a class="headerlink" href="#id17" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>红线是<strong>线性趋势线</strong>，呈明显上升；</p></li>
<li><p>表示模型认为“酒精度每提高 1%，评分平均提升约 0.36 分”；</p></li>
<li><p>然而，它<strong>无法捕捉到非线性效应</strong>（例如评分在高酒精区间趋平）。</p></li>
</ul>
<blockquote>
<div><p><strong>结论</strong>：线性模型只能表达“总体方向”，不能捕捉细节变化。</p>
</div></blockquote>
</section>
<section id="id18">
<h3><strong>（2）随机森林图（第一张图）</strong><a class="headerlink" href="#id18" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p>红线为<strong>模型预测曲线</strong>，可见明显“非线性”：</p>
<ul>
<li><p>低酒精（&lt;9%）评分较低；</p></li>
<li><p>中等酒精（10–12%）评分上升；</p></li>
<li><p>高酒精（&gt;13%）评分趋于平稳甚至略降；</p></li>
</ul>
</li>
<li><p>这说明随机森林识别到了“<strong>适中最优区间</strong>”，符合口感的实际经验。</p></li>
</ul>
<blockquote>
<div><p><strong>结论</strong>：随机森林能更灵活地拟合复杂的真实关系，反映出“非线性”口感规律。</p>
</div></blockquote>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>模型</strong></p></th>
<th class="head"><p><strong>优点</strong></p></th>
<th class="head"><p><strong>局限</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>线性回归</strong></p></td>
<td><p>方程直观、结果可解释、计算快</p></td>
<td><p>无法拟合曲线或交互效应</p></td>
</tr>
<tr class="row-odd"><td><p><strong>随机森林</strong></p></td>
<td><p>自动学习复杂模式、预测精度高</p></td>
<td><p>黑箱性质强，不易解释</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>回到顶部</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="scatter.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>上一章</span><div class="title">散点图</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="casual-chick.html">
      <div class="page-info">
        <span>下一章</span>
        <div class="title">因果分析</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Zhijun Gao</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=c16fcb61"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-YSF8MXKHBM"></script>
      <script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YSF8MXKHBM');
</script>
      <script src="../_static/shibuya.js?v=e730760c"></script></body>
</html>