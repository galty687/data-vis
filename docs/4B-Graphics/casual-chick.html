<!DOCTYPE html>
<html lang="zh" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>因果分析 - data visulization 0.3 文档</title><link rel="index" title="索引" href="../genindex.html" /><link rel="search" title="搜索" href="../search.html" /><link rel="next" title="主成分分析" href="PCA.html" /><link rel="prev" title="相关性分析" href="CA.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=d48c410d" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=04ad0e1e" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="因果分析"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>data visulization</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="搜索" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="切换到亮色模式"
data-aria-light="切换到暗色模式"
data-aria-dark="切换到自动模式">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">课程内容</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1-Intro/intro.html">课程大纲</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-Intro/resources.html">课程资源</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">工具链</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/python.html">Python 入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/jupyter.html">Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/vs_code.html">Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/pandas.html">Pandas 入门</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3-ToolChain/seaborn.html">Seaborn 入门</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">描述性分析</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/bar.html">条形图绘制</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/histogram.html">直方图与核密度图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/boxplot.html">箱线图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/violin.html">小提琴图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/stripplot.html">条带图</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4-Graphics/sina.html">西纳图</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">探索性分析</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="scatter.html">散点图</a></li>
<li class="toctree-l1"><a class="reference internal" href="CA.html">相关性分析</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">因果分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="PCA.html">主成分分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="FA.html">因子分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="casual.html">因果分析挑战</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">数据类型与分析</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../5-Data/data-type.html">常见数据类型</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-Data/data-analysis.html">常见分析方法</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5-Data/descriptive.html">描述性统计常见指标</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">数据叙事</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../6-Storytelling/stories.html">故事类型</a></li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>该页内容</h3><ul>
<li><a class="reference internal" href="#id2">&#22522;&#26412;&#27010;&#24565;</a><ul>
<li><a class="reference internal" href="#id3">&#22240;&#26524;&#25512;&#26029;&#19977;&#35201;&#32032;</a></li>
<li><a class="reference internal" href="#id4">&#22522;&#26412;&#20998;&#26512;&#27493;&#39588;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">&#32463;&#20856;&#26696;&#20363;</a><ul>
<li><a class="reference internal" href="#id6">&#23454;&#39564;&#35774;&#35745;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">&#25968;&#25454;&#20998;&#26512;</a><ul>
<li><a class="reference internal" href="#id8">&#23567;&#40481;&#30340;&#36215;&#22987;&#37325;&#37327;</a></li>
<li><a class="reference internal" href="#id9">&#23454;&#39564;&#21518;&#30340;&#23567;&#40481;&#37325;&#37327;</a><ul>
<li><a class="reference internal" href="#id10">&#23454;&#39564;&#21518;&#30340;&#25551;&#36848;&#24615;&#20998;&#26512;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11">&#36807;&#31243;&#22686;&#37325;&#30340;&#25551;&#36848;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id12">&#30456;&#20851;&#19982;&#22240;&#26524;</a><ul>
<li><a class="reference internal" href="#id13">&#22240;&#26524;&#20998;&#26512;&#30340;&#30446;&#26631;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id14">&#22240;&#26524;&#20998;&#26512;</a><ul>
<li><a class="reference internal" href="#id15">&#32467;&#35770;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">&#22240;&#26524;&#25928;&#24212;&#24046;&#24322;</a><ul>
<li><a class="reference internal" href="#id17">&#20195;&#30721;</a></li>
</ul>
</li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">data visulization</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">因果分析</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <section id="id1">
<h1>因果分析<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<hr class="docutils" />
<p>日常生活中，我们想知道：运动能减肥吗？是不是运动一定能减肥，如果运动能减肥的话，哪种运动方式效果最好，是跑步、游泳还是瑜伽？</p>
<section id="id2">
<h2>基本概念<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>在统计分析中，我们常常会问：</p>
<blockquote>
<div><p>“吃这种饲料的小鸡是不是长得更快？”</p>
</div></blockquote>
<p>这类问题不是单纯的“相关性”问题，而是“因果性”问题。</p>
<p><strong>因果关系（Causality）指的是——当我们主动干预</strong>一个变量（例如改变饲料类型），会不会引起另一个变量（如体重）的变化。</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>概念</p></th>
<th class="head"><p>定义</p></th>
<th class="head"><p>示例</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>相关性（Correlation）</strong></p></td>
<td><p>两个变量一起变化，但不一定存在因果关系。</p></td>
<td><p>每天吃冰淇淋的人数与溺水人数高度相关，但这是因为夏天更热，而不是冰淇淋导致溺水。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>因果性（Causation）</strong></p></td>
<td><p>变量 A 的变化直接引起变量 B 的变化。</p></td>
<td><p>改变饲料类型，会引起小鸡体重的改变。</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>核心思想</strong>：</p>
<blockquote>
<div><p>因果分析要回答“如果我们改变 X，会不会导致 Y 改变？”</p>
</div></blockquote>
<section id="id3">
<h3>因果推断三要素<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>概念</strong></p></th>
<th class="head"><p><strong>在 ChickWeight 中的对应</strong></p></th>
<th class="head"><p><strong>作用</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Treatment（处理）</p></td>
<td><p>饲料种类（Diet）</p></td>
<td><p>我们要干预的变量</p></td>
</tr>
<tr class="row-odd"><td><p>Outcome（结果）</p></td>
<td><p>最终体重（Weight）</p></td>
<td><p>饲料影响的结果</p></td>
</tr>
<tr class="row-even"><td><p>Control（协变量）</p></td>
<td><p>初始体重（weight_start）</p></td>
<td><p>控制潜在混杂</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="id4">
<h3>基本分析步骤<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h3>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>步骤</strong></p></th>
<th class="head"><p><strong>名称</strong></p></th>
<th class="head"><p><strong>主要任务</strong></p></th>
<th class="head"><p><strong>说明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>1. 提出研究问题</strong></p></td>
<td><p>明确因果假设</p></td>
<td><p>明确要回答的“干预效应”问题，即如果改变某个因素 X，会不会导致结果 Y 的变化。</p></td>
<td><p>例如：改变饲料类型是否会导致小鸡体重增加？</p></td>
</tr>
<tr class="row-odd"><td><p><strong>2. 构建因果模型</strong></p></td>
<td><p>绘制因果图（DAG）或建立理论框架</p></td>
<td><p>根据领域知识，明确潜在的因果路径与混杂变量。</p></td>
<td><p>使用有向无环图（DAG）或结构方程表示因果结构。</p></td>
</tr>
<tr class="row-even"><td><p><strong>3. 确定识别策略</strong></p></td>
<td><p>判断能否识别因果效应</p></td>
<td><p>检查是否满足“可识别性假设”，如：随机化、可忽略性（Ignorability）、稳定单元处理值假设（SUTVA）等。</p></td>
<td><p>若无法随机化，则需采用控制、匹配、加权等方法。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>4. 选择估计方法</strong></p></td>
<td><p>选择合适的统计模型或算法</p></td>
<td><p>根据数据类型与研究目的，选择估计因果效应的技术方法。</p></td>
<td><p>例如：OLS、IPTW、Matching、AIPW、Regression Discontinuity、IV、Difference-in-Differences 等。</p></td>
</tr>
<tr class="row-even"><td><p><strong>5. 执行估计与计算</strong></p></td>
<td><p>实际建模并计算 ATE 或 ATT</p></td>
<td><p>在控制混杂变量后，计算处理组与对照组的平均因果效应。</p></td>
<td><p>通过模型输出、置信区间与显著性水平判断结果可靠性。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>6. 验证假设与稳健性分析</strong></p></td>
<td><p>检查模型假设是否成立</p></td>
<td><p>检验共线性、平衡性（balance）、倾向得分分布、异方差等问题。</p></td>
<td><p>可使用敏感性分析（sensitivity analysis）或替代模型进行对比。</p></td>
</tr>
<tr class="row-even"><td><p><strong>7. 解释与可视化结果</strong></p></td>
<td><p>解释因果效应并报告结论</p></td>
<td><p>将数值结果转化为因果意义的解释，展示图表（如效应图、DAG、权重分布）。</p></td>
<td><p>强调“因果解释”而非仅统计显著性。</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="id5">
<h2>经典案例<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<section id="id6">
<h3>实验设计<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p>设计一个<strong>随机对照实验（Randomized Controlled Trial）</strong>。</p>
<ul class="simple">
<li><p>将 50 只小鸡<strong>随机分配</strong>到 4 种不同饲料类型（Diet 1–4）。</p></li>
<li><p>所有小鸡都在相似的环境、温度、饲养条件下成长。</p></li>
<li><p>唯一的差异变量是 <strong>饲料类型（Diet）</strong>。</p></li>
<li><p>记录每只小鸡从出生到第 21 天的多次体重。</p></li>
</ul>
<p>分组情况</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>饮食类型 (Diet)</strong></p></th>
<th class="head"><p><strong>小鸡数量 (Chick count)</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>18 只</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>10 只</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>10 只</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>12 只</p></td>
</tr>
<tr class="row-even"><td><p><strong>合计</strong></p></td>
<td><p><strong>50 只</strong></p></td>
</tr>
</tbody>
</table>
</div>
<p>变量</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>变<strong>量名</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
<th class="head"><p><strong>类型</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>weight</p></td>
<td><p>小鸡的体重（克）</p></td>
<td><p>连续变量</p></td>
</tr>
<tr class="row-odd"><td><p>time</p></td>
<td><p>实验天数（0–21）</p></td>
<td><p>数值型</p></td>
</tr>
<tr class="row-even"><td><p>chick</p></td>
<td><p>小鸡编号（1–50）</p></td>
<td><p>分组变量</p></td>
</tr>
<tr class="row-odd"><td><p>diet</p></td>
<td><p>饲料类型（1–4）</p></td>
<td><p>类别变量</p></td>
</tr>
</tbody>
</table>
</div>
<p>饲料类型（Diet）是“因”（Treatment），体重（Weight）是“果”（Outcome），其他条件保持不变（Control），满足因果推断的“反事实框架”。</p>
</section>
</section>
<section id="id7">
<h2>数据分析<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<section id="id8">
<h3>小鸡的起始重量<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<p>了解一下小鸡的起始重量</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span data-line="4"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># 读取数据</span>
</span><span data-line="7"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;chickweight.csv&quot;</span><span class="p">)</span>
</span><span data-line="8"><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span data-line="9"><span class="n">w0</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</span><span data-line="10">
</span><span data-line="11"><span class="c1"># 计算均值和95%置信区间</span>
</span><span data-line="12"><span class="n">grouped</span> <span class="o">=</span> <span class="n">w0</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;diet&quot;</span><span class="p">)[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
</span><span data-line="13"><span class="n">means</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span data-line="14"><span class="n">stds</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span data-line="15"><span class="n">ns</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span data-line="16"><span class="n">cis</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">stds</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
</span><span data-line="17">
</span><span data-line="18"><span class="c1"># 绘图</span>
</span><span data-line="19"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><span data-line="20">
</span><span data-line="21"><span class="c1"># 先画条带图（每只小鸡的初始体重）</span>
</span><span data-line="22"><span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
</span><span data-line="23">    <span class="n">data</span><span class="o">=</span><span class="n">w0</span><span class="p">,</span> 
</span><span data-line="24">    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> 
</span><span data-line="25">    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">,</span> 
</span><span data-line="26">    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span>
</span><span data-line="27">    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> 
</span><span data-line="28">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span data-line="29">    <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span data-line="30">    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="31">  
</span><span data-line="32"><span class="p">)</span>
</span><span data-line="33">
</span><span data-line="34"><span class="c1"># 再叠加均值 ± 95% CI</span>
</span><span data-line="35"><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
</span><span data-line="36">    <span class="n">means</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># 因为 x 轴是分组编号 1~4，matplotlib 默认从 0 开始，需要减1</span>
</span><span data-line="37">    <span class="n">means</span><span class="p">,</span>
</span><span data-line="38">    <span class="n">yerr</span><span class="o">=</span><span class="n">cis</span><span class="p">,</span>
</span><span data-line="39">    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
</span><span data-line="40">    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span><span data-line="41">    <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span><span data-line="42">    <span class="n">elinewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span data-line="43">    <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="44">    <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span data-line="45">    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean ± 95% CI&#39;</span><span class="p">,</span>
</span><span data-line="46">    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="47"><span class="p">)</span>
</span><span data-line="48">
</span><span data-line="49"><span class="c1"># 图形样式</span>
</span><span data-line="50"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Initial Weight by Diet Group&quot;</span><span class="p">)</span>
</span><span data-line="51"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Diet Group&quot;</span><span class="p">)</span>
</span><span data-line="52"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Initial Weight (grams)&quot;</span><span class="p">)</span>
</span><span data-line="53"><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">44</span><span class="p">)</span>
</span><span data-line="54"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="55"><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span data-line="56"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span data-line="57">
</span><span data-line="58">
</span><span data-line="59"><span class="c1"># 输出为表格</span>
</span><span data-line="60"><span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span data-line="61">    <span class="s2">&quot;Mean&quot;</span><span class="p">:</span> <span class="n">means</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span data-line="62">    <span class="s2">&quot;Std&quot;</span><span class="p">:</span> <span class="n">stds</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span data-line="63">    <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="n">ns</span><span class="p">,</span>
</span><span data-line="64">    <span class="s2">&quot;95% CI&quot;</span><span class="p">:</span> <span class="n">cis</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="65"><span class="p">})</span>
</span><span data-line="66"><span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</span><span data-line="67">
</span><span data-line="68"><span class="c1"># =============================</span>
</span><span data-line="69"><span class="c1"># 方差分析（ANOVA）</span>
</span><span data-line="70"><span class="c1"># =============================</span>
</span><span data-line="71"><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">w0</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w0</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">w0</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>
</span><span data-line="72"><span class="n">f_stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">f_oneway</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">)</span>
</span><span data-line="73">
</span><span data-line="74"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== 单因素方差分析（ANOVA） ===&quot;</span><span class="p">)</span>
</span><span data-line="75"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F 统计量: </span><span class="si">{</span><span class="n">f_stat</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="76"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p 值: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="77">
</span><span data-line="78"><span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span><span data-line="79">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;→ 结论：不同饲料组的初始体重存在显著差异。&quot;</span><span class="p">)</span>
</span><span data-line="80"><span class="k">else</span><span class="p">:</span>
</span><span data-line="81">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;→ 结论：不同饲料组的初始体重无显著差异（分组较平衡）。&quot;</span><span class="p">)</span>
</span><span data-line="82"><span class="nb">print</span><span class="p">()</span>
</span><span data-line="83">
</span><span data-line="84">
</span></pre></div>
</div>
<p><img alt="chick-strip" src="../_images/chick-strip.png" /></p>
<p>数据的描述性分析</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">			<span class="n">Mean</span>    <span class="n">Std</span>   <span class="n">N</span>  <span class="mi">95</span><span class="o">%</span> <span class="n">CI</span>
</span><span data-line="2"><span class="n">diet</span>                         
</span><span data-line="3"><span class="mi">1</span>     <span class="mf">41.4</span>  <span class="mf">0.995</span>  <span class="mi">20</span>   <span class="mf">0.436</span>
</span><span data-line="4"><span class="mi">2</span>     <span class="mf">40.7</span>  <span class="mf">1.494</span>  <span class="mi">10</span>   <span class="mf">0.926</span>
</span><span data-line="5"><span class="mi">3</span>     <span class="mf">40.8</span>  <span class="mf">1.033</span>  <span class="mi">10</span>   <span class="mf">0.640</span>
</span><span data-line="6"><span class="mi">4</span>     <span class="mf">41.0</span>  <span class="mf">1.054</span>  <span class="mi">10</span>   <span class="mf">0.653</span>
</span></pre></div>
</div>
<ol class="arabic simple">
<li><p>四组的组间差异很小：四组平均体重都在 40.7–41.4 g 之间，说明实验开始时各组小鸡的初始体重非常接近。</p></li>
<li><p>标准差反应组内一致性：饲料1组标准差最小（0.995），说明这组小鸡初始体重最均匀；饲料2组标准差最大（1.494），个体差异稍大。</p></li>
<li><p>95%置信区间：饲料1组的平均体重 41.4 ± 0.436，意味着有95%的信心认为该组总体平均体重在[40.964, 41.836] 克之间，类似地，饲料2组为 [39.774, 41.626]。</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">=== 单因素方差分析（ANOVA） ===
</span><span data-line="2">F 统计量: 1.132
</span><span data-line="3">p 值: 0.34591
</span></pre></div>
</div>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>标</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
<th class="head"><p><strong>解读</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>F统计量 (F-statistic)</strong></p></td>
<td><p>衡量组间方差与组内方差的比值。值越大，组间差异越明显。</p></td>
<td><p>这里 F=1.132，说明组间差异与组内差异相比并不大。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>p值 (p-value)</strong></p></td>
<td><p>代表「组间平均值差异是否显著」。当 p &lt; 0.05 时，认为至少有一组与其他组显著不同。</p></td>
<td><p>这里 p=0.34591 &gt; 0.05，说明统计上没有显著差异。</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>结论</strong></p>
<p>四组小鸡在实验开始时体重差异不显著（均值几乎重叠，置信区间重叠明显），因此，可以认为 实验起点是平衡的，适合后续比较不同饲料对生长速度或最终体重的影响。实验起点公平，后续体重差异可归因于饲料效果，而非起始体重不同。</p>
</section>
<section id="id9">
<h3>实验后的小鸡重量<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<section id="id10">
<h4>实验后的描述性分析<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span data-line="4"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="5"><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">f_oneway</span>
</span><span data-line="6"><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.stats.multicomp</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_tukeyhsd</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># 读取数据</span>
</span><span data-line="9"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;chickweight.csv&quot;</span><span class="p">)</span>
</span><span data-line="10"><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># 选取实验结束时（最后一天）的小鸡体重</span>
</span><span data-line="13"><span class="n">w_final</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
</span><span data-line="14">
</span><span data-line="15"><span class="c1"># 计算均值和95%置信区间</span>
</span><span data-line="16"><span class="n">grouped</span> <span class="o">=</span> <span class="n">w_final</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;diet&quot;</span><span class="p">)[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
</span><span data-line="17"><span class="n">means</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span data-line="18"><span class="n">stds</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</span><span data-line="19"><span class="n">ns</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</span><span data-line="20"><span class="n">cis</span> <span class="o">=</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">stds</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ns</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># =============================</span>
</span><span data-line="23"><span class="c1"># 图1：条带图 + 平均值 ±95% CI</span>
</span><span data-line="24"><span class="c1"># =============================</span>
</span><span data-line="25"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><span data-line="26"><span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
</span><span data-line="27">    <span class="n">data</span><span class="o">=</span><span class="n">w_final</span><span class="p">,</span> 
</span><span data-line="28">    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> 
</span><span data-line="29">    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">,</span> 
</span><span data-line="30">    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span>
</span><span data-line="31">    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> 
</span><span data-line="32">    <span class="n">jitter</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
</span><span data-line="33">    <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
</span><span data-line="34">    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="35"><span class="p">)</span>
</span><span data-line="36">
</span><span data-line="37"><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span>
</span><span data-line="38">    <span class="n">means</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span data-line="39">    <span class="n">means</span><span class="p">,</span>
</span><span data-line="40">    <span class="n">yerr</span><span class="o">=</span><span class="n">cis</span><span class="p">,</span>
</span><span data-line="41">    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
</span><span data-line="42">    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span><span data-line="43">    <span class="n">ecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
</span><span data-line="44">    <span class="n">elinewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span data-line="45">    <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="46">    <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span data-line="47">    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Mean ± 95% CI&#39;</span><span class="p">,</span>
</span><span data-line="48">    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="49"><span class="p">)</span>
</span><span data-line="50">
</span><span data-line="51"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Final Weight by Diet Group&quot;</span><span class="p">)</span>
</span><span data-line="52"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Diet Group&quot;</span><span class="p">)</span>
</span><span data-line="53"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Final Weight (grams)&quot;</span><span class="p">)</span>
</span><span data-line="54"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="55"><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span data-line="56"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span data-line="57">
</span><span data-line="58"><span class="c1"># =============================</span>
</span><span data-line="59"><span class="c1"># 图2：箱线图 + 条带图叠加</span>
</span><span data-line="60"><span class="c1"># =============================</span>
</span><span data-line="61"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><span data-line="62"><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
</span><span data-line="63">    <span class="n">data</span><span class="o">=</span><span class="n">w_final</span><span class="p">,</span> 
</span><span data-line="64">    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> 
</span><span data-line="65">    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">,</span> 
</span><span data-line="66">    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span>
</span><span data-line="67">    <span class="n">width</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
</span><span data-line="68">    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="69"><span class="p">)</span>
</span><span data-line="70">
</span><span data-line="71"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Final Weight Distribution by Diet (Boxplot)&quot;</span><span class="p">)</span>
</span><span data-line="72"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Diet Group&quot;</span><span class="p">)</span>
</span><span data-line="73"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Final Weight (grams)&quot;</span><span class="p">)</span>
</span><span data-line="74"><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</span><span data-line="75"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span data-line="76">
</span><span data-line="77"><span class="c1"># =============================</span>
</span><span data-line="78"><span class="c1"># 输出表格</span>
</span><span data-line="79"><span class="c1"># =============================</span>
</span><span data-line="80"><span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span data-line="81">    <span class="s2">&quot;Mean&quot;</span><span class="p">:</span> <span class="n">means</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span data-line="82">    <span class="s2">&quot;Std&quot;</span><span class="p">:</span> <span class="n">stds</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
</span><span data-line="83">    <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="n">ns</span><span class="p">,</span>
</span><span data-line="84">    <span class="s2">&quot;95% CI&quot;</span><span class="p">:</span> <span class="n">cis</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="85"><span class="p">})</span>
</span><span data-line="86"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== 描述性统计：实验结束时体重 ===&quot;</span><span class="p">)</span>
</span><span data-line="87"><span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</span><span data-line="88"><span class="nb">print</span><span class="p">()</span>
</span><span data-line="89">
</span><span data-line="90"><span class="c1"># =============================</span>
</span><span data-line="91"><span class="c1"># 方差分析（ANOVA）</span>
</span><span data-line="92"><span class="c1"># =============================</span>
</span><span data-line="93"><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">w_final</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w_final</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">w_final</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>
</span><span data-line="94"><span class="n">f_stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">f_oneway</span><span class="p">(</span><span class="o">*</span><span class="n">groups</span><span class="p">)</span>
</span><span data-line="95">
</span><span data-line="96"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== 单因素方差分析（ANOVA） ===&quot;</span><span class="p">)</span>
</span><span data-line="97"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F 统计量: </span><span class="si">{</span><span class="n">f_stat</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="98"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p 值: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="99">
</span><span data-line="100"><span class="k">if</span> <span class="n">p_value</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
</span><span data-line="101">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;→ 结论：不同饲料组的最终体重存在显著差异。&quot;</span><span class="p">)</span>
</span><span data-line="102"><span class="k">else</span><span class="p">:</span>
</span><span data-line="103">    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;→ 结论：不同饲料组的最终体重无显著差异。&quot;</span><span class="p">)</span>
</span><span data-line="104"><span class="nb">print</span><span class="p">()</span>
</span><span data-line="105">
</span><span data-line="106">
</span></pre></div>
</div>
<p><img alt="chick-strip-final" src="../_images/chick-strip-final.png" /></p>
<p><img alt="chick-boxplot" src="../_images/chick-boxplot.png" /></p>
<p>=== 描述性统计：实验结束时体重 ===</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">
</span><span data-line="2">         <span class="n">Mean</span>     <span class="n">Std</span>   <span class="n">N</span>  <span class="mi">95</span><span class="o">%</span> <span class="n">CI</span>
</span><span data-line="3"><span class="n">diet</span>                             
</span><span data-line="4"><span class="mi">1</span>     <span class="mf">177.750</span>  <span class="mf">58.702</span>  <span class="mi">16</span>  <span class="mf">28.764</span>
</span><span data-line="5"><span class="mi">2</span>     <span class="mf">214.700</span>  <span class="mf">78.138</span>  <span class="mi">10</span>  <span class="mf">48.431</span>
</span><span data-line="6"><span class="mi">3</span>     <span class="mf">270.300</span>  <span class="mf">71.623</span>  <span class="mi">10</span>  <span class="mf">44.392</span>
</span><span data-line="7"><span class="mi">4</span>     <span class="mf">238.556</span>  <span class="mf">43.348</span>   <span class="mi">9</span>  <span class="mf">28.321</span>
</span></pre></div>
</div>
<p>结果解读</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>饲料组</strong></p></th>
<th class="head"><p><strong>平均体重 (g)</strong></p></th>
<th class="head"><p><strong>标准差</strong></p></th>
<th class="head"><p><strong>样本量</strong></p></th>
<th class="head"><p><strong>95% CI</strong></p></th>
<th class="head"><p><strong>说明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Diet 1</strong></p></td>
<td><p>177.8</p></td>
<td><p>58.7</p></td>
<td><p>16</p></td>
<td><p>±28.8</p></td>
<td><p>体重最低，且个体差异较大，说明该饲料增重效果最弱。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Diet 2</strong></p></td>
<td><p>214.7</p></td>
<td><p>78.1</p></td>
<td><p>10</p></td>
<td><p>±48.4</p></td>
<td><p>平均体重略高于 1 组，但波动很大，效果不稳定。</p></td>
</tr>
<tr class="row-even"><td><p><strong>Diet 3</strong></p></td>
<td><p>270.3</p></td>
<td><p>71.6</p></td>
<td><p>10</p></td>
<td><p>±44.4</p></td>
<td><p>平均体重最高，说明此饲料促进生长最显著。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Diet 4</strong></p></td>
<td><p>238.6</p></td>
<td><p>43.3</p></td>
<td><p>9</p></td>
<td><p>±28.3</p></td>
<td><p>体重较高且标准差较小，说明该饲料效果较好且稳定。</p></td>
</tr>
</tbody>
</table>
</div>
<p>意义</p>
<ol class="arabic">
<li><p><strong>饲料种类影响显著</strong></p>
<p>平均体重从 ~178 g 到 ~270 g 变化，差距接近 100 g。说明不同饲料对生长的促进作用明显不同。</p>
</li>
<li><p><strong>Diet 3 最优</strong></p>
<p>该组平均体重最高，说明其营养配比最有利于小鸡的体重增长。</p>
</li>
<li><p><strong>Diet 1 最弱</strong></p>
<p>平均体重最低，且组内差异大，可能饲料营养不足或个体反应不一致。</p>
</li>
<li><p><strong>Diet 4 稳定性好</strong></p>
<p>标准差最小，说明这组小鸡体重分布集中、生长一致。</p>
</li>
<li><p><strong>置信区间解读</strong></p>
<p>例如 Diet 3 的 95% CI 为 ±44.4 ，意味着我们有 95% 的信心认为该组总体平均体重位于 270.3 ± 44.4 g 之间（约 226 – 315 g）。</p>
</li>
</ol>
</section>
</section>
<section id="id11">
<h3>过程增重的描述<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="2"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span data-line="4"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="5">
</span><span data-line="6"><span class="c1"># 读取数据</span>
</span><span data-line="7"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;chickweight.csv&quot;</span><span class="p">)</span>
</span><span data-line="8"><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span data-line="9">
</span><span data-line="10"><span class="c1"># =============================</span>
</span><span data-line="11"><span class="c1"># 可视化：各饲料组随时间体重变化</span>
</span><span data-line="12"><span class="c1"># =============================</span>
</span><span data-line="13"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
</span><span data-line="14"><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
</span><span data-line="15">    <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span>
</span><span data-line="16">    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span>
</span><span data-line="17">    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span>
</span><span data-line="18">    <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">),</span>  <span class="c1"># 显示均值 ±95% CI</span>
</span><span data-line="19">    <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;pastel&quot;</span><span class="p">,</span>
</span><span data-line="20">    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span>
</span><span data-line="21"><span class="p">)</span>
</span><span data-line="22"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Weight Growth Over Time by Diet&quot;</span><span class="p">)</span>
</span><span data-line="23"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Days&quot;</span><span class="p">)</span>
</span><span data-line="24"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Average Weight (grams)&quot;</span><span class="p">)</span>
</span><span data-line="25"><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</span><span data-line="26"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span data-line="27">
</span><span data-line="28"><span class="c1"># =============================</span>
</span><span data-line="29"><span class="c1"># 计算每个时间点的描述性统计</span>
</span><span data-line="30"><span class="c1"># =============================</span>
</span><span data-line="31"><span class="n">summary</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="32">    <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;diet&quot;</span><span class="p">])[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span>
</span><span data-line="33">      <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">Mean</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">Std</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
</span><span data-line="34">      <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">CI</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="mf">1.96</span> <span class="o">*</span> <span class="n">s</span><span class="p">[</span><span class="s2">&quot;Std&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]))</span>
</span><span data-line="35">      <span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="36"><span class="p">)</span>
</span><span data-line="37"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== 各时间点各饲料组体重描述统计 ===&quot;</span><span class="p">)</span>
</span><span data-line="38"><span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>  <span class="c1"># 仅显示前20行以便查看结构</span>
</span><span data-line="39">
</span><span data-line="40"><span class="c1"># =============================</span>
</span><span data-line="41"><span class="c1"># 计算平均增重趋势（首尾差）</span>
</span><span data-line="42"><span class="c1"># =============================</span>
</span><span data-line="43"><span class="n">first</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;diet&quot;</span><span class="p">)[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span data-line="44"><span class="n">last</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;diet&quot;</span><span class="p">)[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span data-line="45"><span class="n">gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">last</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="46">
</span><span data-line="47"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== 实验期间平均增重（最终均值 - 初始均值） ===&quot;</span><span class="p">)</span>
</span><span data-line="48"><span class="nb">print</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span>
</span><span data-line="49">
</span><span data-line="50"><span class="c1"># =============================</span>
</span><span data-line="51"><span class="c1"># 简要解释</span>
</span><span data-line="52"><span class="c1"># =============================</span>
</span><span data-line="53"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== 结果解读 ===&quot;</span><span class="p">)</span>
</span><span data-line="54"><span class="k">for</span> <span class="n">diet</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">gain</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span data-line="55">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Diet </span><span class="si">{</span><span class="n">diet</span><span class="si">}</span><span class="s2">: 平均增重 </span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s2"> 克。&quot;</span><span class="p">)</span>
</span><span data-line="56"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;从结果可见，不同饲料组的体重增长速度不同，其中增重最多的组在曲线中上升最陡（通常为 Diet 3）。&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<p><img alt="chick-lineplot" src="../_images/chick-lineplot.png" /></p>
<p>各时间点各饲料组体重描述统计</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">    <span class="n">time</span>  <span class="n">diet</span>    <span class="n">Mean</span>    <span class="n">Std</span>   <span class="n">N</span>    <span class="n">CI</span>
</span><span data-line="2"><span class="mi">0</span>      <span class="mi">0</span>     <span class="mi">1</span>   <span class="mf">41.40</span>   <span class="mf">0.99</span>  <span class="mi">20</span>  <span class="mf">0.44</span>
</span><span data-line="3"><span class="mi">1</span>      <span class="mi">0</span>     <span class="mi">2</span>   <span class="mf">40.70</span>   <span class="mf">1.49</span>  <span class="mi">10</span>  <span class="mf">0.93</span>
</span><span data-line="4"><span class="mi">2</span>      <span class="mi">0</span>     <span class="mi">3</span>   <span class="mf">40.80</span>   <span class="mf">1.03</span>  <span class="mi">10</span>  <span class="mf">0.64</span>
</span><span data-line="5"><span class="mi">3</span>      <span class="mi">0</span>     <span class="mi">4</span>   <span class="mf">41.00</span>   <span class="mf">1.05</span>  <span class="mi">10</span>  <span class="mf">0.65</span>
</span><span data-line="6"><span class="mi">4</span>      <span class="mi">2</span>     <span class="mi">1</span>   <span class="mf">47.25</span>   <span class="mf">4.28</span>  <span class="mi">20</span>  <span class="mf">1.87</span>
</span><span data-line="7"><span class="mi">5</span>      <span class="mi">2</span>     <span class="mi">2</span>   <span class="mf">49.40</span>   <span class="mf">2.88</span>  <span class="mi">10</span>  <span class="mf">1.78</span>
</span><span data-line="8"><span class="mi">6</span>      <span class="mi">2</span>     <span class="mi">3</span>   <span class="mf">50.40</span>   <span class="mf">2.41</span>  <span class="mi">10</span>  <span class="mf">1.50</span>
</span><span data-line="9"><span class="mi">7</span>      <span class="mi">2</span>     <span class="mi">4</span>   <span class="mf">51.80</span>   <span class="mf">1.93</span>  <span class="mi">10</span>  <span class="mf">1.20</span>
</span><span data-line="10"><span class="mi">8</span>      <span class="mi">4</span>     <span class="mi">1</span>   <span class="mf">56.47</span>   <span class="mf">4.13</span>  <span class="mi">19</span>  <span class="mf">1.86</span>
</span><span data-line="11"><span class="mi">9</span>      <span class="mi">4</span>     <span class="mi">2</span>   <span class="mf">59.80</span>   <span class="mf">2.30</span>  <span class="mi">10</span>  <span class="mf">1.43</span>
</span><span data-line="12"><span class="mi">10</span>     <span class="mi">4</span>     <span class="mi">3</span>   <span class="mf">62.20</span>   <span class="mf">2.78</span>  <span class="mi">10</span>  <span class="mf">1.72</span>
</span><span data-line="13"><span class="mi">11</span>     <span class="mi">4</span>     <span class="mi">4</span>   <span class="mf">64.50</span>   <span class="mf">2.55</span>  <span class="mi">10</span>  <span class="mf">1.58</span>
</span><span data-line="14"><span class="mi">12</span>     <span class="mi">6</span>     <span class="mi">1</span>   <span class="mf">66.79</span>   <span class="mf">7.76</span>  <span class="mi">19</span>  <span class="mf">3.49</span>
</span><span data-line="15"><span class="mi">13</span>     <span class="mi">6</span>     <span class="mi">2</span>   <span class="mf">75.40</span>   <span class="mf">4.17</span>  <span class="mi">10</span>  <span class="mf">2.58</span>
</span><span data-line="16"><span class="mi">14</span>     <span class="mi">6</span>     <span class="mi">3</span>   <span class="mf">77.90</span>   <span class="mf">5.70</span>  <span class="mi">10</span>  <span class="mf">3.54</span>
</span><span data-line="17"><span class="mi">15</span>     <span class="mi">6</span>     <span class="mi">4</span>   <span class="mf">83.90</span>   <span class="mf">5.07</span>  <span class="mi">10</span>  <span class="mf">3.14</span>
</span><span data-line="18"><span class="mi">16</span>     <span class="mi">8</span>     <span class="mi">1</span>   <span class="mf">79.68</span>  <span class="mf">13.78</span>  <span class="mi">19</span>  <span class="mf">6.19</span>
</span><span data-line="19"><span class="mi">17</span>     <span class="mi">8</span>     <span class="mi">2</span>   <span class="mf">91.70</span>  <span class="mf">14.80</span>  <span class="mi">10</span>  <span class="mf">9.17</span>
</span><span data-line="20"><span class="mi">18</span>     <span class="mi">8</span>     <span class="mi">3</span>   <span class="mf">98.40</span>  <span class="mf">12.35</span>  <span class="mi">10</span>  <span class="mf">7.65</span>
</span><span data-line="21"><span class="mi">19</span>     <span class="mi">8</span>     <span class="mi">4</span>  <span class="mf">105.60</span>   <span class="mf">9.34</span>  <span class="mi">10</span>  <span class="mf">5.79</span>
</span></pre></div>
</div>
<p>实验期间平均增重（最终均值 - 初始均值）</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">Diet 1: 平均增重 136.35 克。
</span><span data-line="2">Diet 2: 平均增重 174.0 克。
</span><span data-line="3">Diet 3: 平均增重 229.5 克。
</span><span data-line="4">Diet 4: 平均增重 197.56 克。
</span></pre></div>
</div>
<p>从结果可见，不同饲料组的体重增长速度不同，其中增重最多的组在曲线中上升最陡（通常为 Diet 3）。</p>
</section>
</section>
<section id="id12">
<h2>相关与因果<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h2>
<p>我们已经通过描述性统计或 ANOVA 知道 <strong>Diet 3 的小鸡体重最高</strong>，但是我们仍然不能直接说：<strong>Diet 3 导致了小鸡长得最快</strong>。</p>
<p>最后的统计数据表明，Diet3 组的平均体重最高，这只是<strong>观测到的相关现象</strong>，但我们还不知道，这是由于饲料导致的，还是别的因素（如小鸡原来更健康，样本数量不同等等）。</p>
<p>因果分析要回答的是“如果我改变饲料，会不会导致体重变化？”，也就是所谓的 反事实问题（counterfactual）：</p>
<blockquote>
<div><p>如果原来吃 Diet 1 的那只小鸡改吃 Diet 3，
它的体重是否真的会比现在更高？</p>
</div></blockquote>
<p>这个问题不能靠平均数直接回答，因为它涉及<strong>假设世界</strong>（what-if world）。</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>类比</strong></p></th>
<th class="head"><p><strong>解释</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>你发现“带伞的人更多的时候街上更湿”</p></td>
<td><p>描述性统计：伞与湿度相关</p></td>
</tr>
<tr class="row-odd"><td><p>但并不是“带伞导致下雨”</p></td>
<td><p>因果分析：要判断是“下雨导致带伞”</p></td>
</tr>
</tbody>
</table>
</div>
<p>同理，“Diet 3 小鸡更重” ≠ “Diet 3 导致更重”，还可能是 Diet 3 组原本的小鸡体质更好。</p>
<section id="id13">
<h3>因果分析的目标<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h3>
<p>在控制其他因素后，判断“饲料种类”是否是<strong>导致体重差异的真正原因</strong>。</p>
</section>
</section>
<section id="id14">
<h2>因果分析<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="2"><span class="kn">from</span><span class="w"> </span><span class="nn">dowhy</span><span class="w"> </span><span class="kn">import</span> <span class="n">CausalModel</span>
</span><span data-line="3">
</span><span data-line="4"><span class="c1"># 读取数据</span>
</span><span data-line="5"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;chickweight.csv&quot;</span><span class="p">)</span>
</span><span data-line="6"><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span data-line="7">
</span><span data-line="8"><span class="c1"># 提取实验开始（初始体重）与结束（最终体重）的数据</span>
</span><span data-line="9"><span class="n">start</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][[</span><span class="s2">&quot;chick&quot;</span><span class="p">,</span> <span class="s2">&quot;diet&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;weight_start&quot;</span><span class="p">})</span>
</span><span data-line="10"><span class="n">end</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()][[</span><span class="s2">&quot;chick&quot;</span><span class="p">,</span> <span class="s2">&quot;diet&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;weight_end&quot;</span><span class="p">})</span>
</span><span data-line="11">
</span><span data-line="12"><span class="c1"># 合并前后体重</span>
</span><span data-line="13"><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;chick&quot;</span><span class="p">,</span> <span class="s2">&quot;diet&quot;</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
</span><span data-line="14"><span class="n">data</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;weight_end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;weight_start&quot;</span><span class="p">]</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># ----------------------------</span>
</span><span data-line="17"><span class="c1"># 1. 定义因果模型</span>
</span><span data-line="18"><span class="c1"># ----------------------------</span>
</span><span data-line="19"><span class="n">model</span> <span class="o">=</span> <span class="n">CausalModel</span><span class="p">(</span>
</span><span data-line="20">    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
</span><span data-line="21">    <span class="n">treatment</span><span class="o">=</span><span class="s2">&quot;diet&quot;</span><span class="p">,</span>       <span class="c1"># 饲料类型</span>
</span><span data-line="22">    <span class="n">outcome</span><span class="o">=</span><span class="s2">&quot;weight_end&quot;</span><span class="p">,</span>   <span class="c1"># 最终体重</span>
</span><span data-line="23">    <span class="n">common_causes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;weight_start&quot;</span><span class="p">]</span>  <span class="c1"># 初始体重作为混杂变量</span>
</span><span data-line="24"><span class="p">)</span>
</span><span data-line="25">
</span><span data-line="26"><span class="c1"># 可视化因果图（可选）</span>
</span><span data-line="27"><span class="n">model</span><span class="o">.</span><span class="n">view_model</span><span class="p">()</span>
</span><span data-line="28">
</span><span data-line="29"><span class="c1"># ----------------------------</span>
</span><span data-line="30"><span class="c1"># 2. 识别因果效应</span>
</span><span data-line="31"><span class="c1"># ----------------------------</span>
</span><span data-line="32"><span class="n">identified_estimand</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">identify_effect</span><span class="p">(</span><span class="n">proceed_when_unidentifiable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="33"><span class="nb">print</span><span class="p">(</span><span class="n">identified_estimand</span><span class="p">)</span>
</span><span data-line="34">
</span><span data-line="35"><span class="c1"># ----------------------------</span>
</span><span data-line="36"><span class="c1"># 3. 估计因果效应（使用线性回归）</span>
</span><span data-line="37"><span class="c1"># ----------------------------</span>
</span><span data-line="38"><span class="n">estimate</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">estimate_effect</span><span class="p">(</span>
</span><span data-line="39">    <span class="n">identified_estimand</span><span class="p">,</span>
</span><span data-line="40">    <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;backdoor.linear_regression&quot;</span>
</span><span data-line="41"><span class="p">)</span>
</span><span data-line="42"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;因果效应估计值（平均效应 ATE）:&quot;</span><span class="p">)</span>
</span><span data-line="43"><span class="nb">print</span><span class="p">(</span><span class="n">estimate</span><span class="p">)</span>
</span><span data-line="44">
</span><span data-line="45"><span class="c1"># ----------------------------</span>
</span><span data-line="46"><span class="c1"># 4. 随机化安慰检验（可选，检验稳健性）</span>
</span><span data-line="47"><span class="c1"># ----------------------------</span>
</span><span data-line="48"><span class="n">refutation</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">refute_estimate</span><span class="p">(</span>
</span><span data-line="49">    <span class="n">identified_estimand</span><span class="p">,</span> <span class="n">estimate</span><span class="p">,</span> <span class="n">method_name</span><span class="o">=</span><span class="s2">&quot;placebo_treatment_refuter&quot;</span>
</span><span data-line="50"><span class="p">)</span>
</span><span data-line="51"><span class="nb">print</span><span class="p">(</span><span class="n">refutation</span><span class="p">)</span>
</span></pre></div>
</div>
<p>运行后输出的图：</p>
<p><img alt="chick-dag" src="../_images/chick-dag.png" /></p>
<p>结果解读：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">weight_start → diet → weight_end
</span><span data-line="2">      ↘──────────────↗
</span></pre></div>
</div>
<p>各节点含义：</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>节点</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>weight_start</strong></p></td>
<td><p>小鸡的初始体重（实验前）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>diet</strong></p></td>
<td><p>饲料类型（实验处理变量）</p></td>
</tr>
<tr class="row-even"><td><p><strong>weight_end</strong></p></td>
<td><p>小鸡的最终体重（实验结果变量）</p></td>
</tr>
</tbody>
</table>
</div>
<p>各箭头含义：</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>箭头</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>weight_start → diet</strong></p></td>
<td><p>初始体重可能影响小鸡被分配到不同饲料组（潜在混杂关系）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>weight_start → weight_end</strong></p></td>
<td><p>初始体重越大，小鸡可能最终体重也越大</p></td>
</tr>
<tr class="row-even"><td><p><strong>diet → weight_end</strong></p></td>
<td><p>饲料类型影响最终体重（我们要估计的因果效应）</p></td>
</tr>
</tbody>
</table>
</div>
<p>DAG 的作用：告诉我们“需要控制谁”。
在 ChickWeight 中，weight_start 是混杂变量，必须在模型中控制，否则会高估 Diet 效果。</p>
<div class="highlight-markdown notranslate"><div class="highlight"><pre><span></span><span data-line="1">Estimand type: EstimandType.NONPARAMETRIC_ATE
</span><span data-line="2">
</span><span data-line="3"><span class="gu">### Estimand : 1</span>
</span><span data-line="4">Estimand name: backdoor
</span><span data-line="5">Estimand expression:
</span><span data-line="6">   d                               
</span><span data-line="7">───────(E[weight_end|weight_start])
</span><span data-line="8">d[diet]                            
</span><span data-line="9">Estimand assumption 1, Unconfoundedness: If U→{diet} and U→weight_end then P(weight_end|diet,weight_start,U) = P(weight_end|diet,weight_start)
</span><span data-line="10">
</span><span data-line="11"><span class="gu">### Estimand : 2</span>
</span><span data-line="12">Estimand name: iv
</span><span data-line="13">No such variable(s) found!
</span><span data-line="14">
</span><span data-line="15"><span class="gu">### Estimand : 3</span>
</span><span data-line="16">Estimand name: frontdoor
</span><span data-line="17">No such variable(s) found!
</span><span data-line="18">
</span><span data-line="19"><span class="gu">### Estimand : 4</span>
</span><span data-line="20">Estimand name: general_adjustment
</span><span data-line="21">Estimand expression:
</span><span data-line="22">   d                               
</span><span data-line="23">───────(E[weight_end|weight_start])
</span><span data-line="24">d[diet]                            
</span><span data-line="25">Estimand assumption 1, Unconfoundedness: If U→{diet} and U→weight_end then P(weight_end|diet,weight_start,U) = P(weight_end|diet,weight_start)
</span><span data-line="26">
</span><span data-line="27">因果效应估计值（平均效应 ATE）:
</span><span data-line="28">*** Causal Estimate ***
</span><span data-line="29">
</span><span data-line="30"><span class="gu">## Identified estimand</span>
</span><span data-line="31">Estimand type: EstimandType.NONPARAMETRIC_ATE
</span><span data-line="32">
</span><span data-line="33"><span class="gu">### Estimand : 1</span>
</span><span data-line="34">Estimand name: backdoor
</span><span data-line="35">Estimand expression:
</span><span data-line="36">   d                               
</span><span data-line="37">───────(E[weight_end|weight_start])
</span><span data-line="38">d[diet]                            
</span><span data-line="39">Estimand assumption 1, Unconfoundedness: If U→{diet} and U→weight_end then P(weight_end|diet,weight_start,U) = P(weight_end|diet,weight_start)
</span><span data-line="40">
</span><span data-line="41"><span class="gu">## Realized estimand</span>
</span><span data-line="42">b: weight_end~diet+weight_start
</span><span data-line="43">Target units: ate
</span><span data-line="44">
</span><span data-line="45"><span class="gu">## Estimate</span>
</span><span data-line="46">Mean value: 22.838360745962177
</span></pre></div>
</div>
<section id="id15">
<h3>结论<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<p>当我们控制初始体重 (weight_start) 后，饲料 (diet) 对最终体重 (weight_end) 的平均因果效应（ATE）约为 22.84 克，也就是说——在平均意义上，<strong>更换饲料会导致小鸡最终体重增加约 23 克</strong>。</p>
<p>ATE 表示：</p>
<blockquote>
<div><p>“如果我们随机地把所有小鸡从原本的饲料换成某个目标饲料（这里是 Diet 3），
那么平均而言，小鸡的最终体重会增加（或减少）多少克。”</p>
</div></blockquote>
<p>也就是说：</p>
<ul class="simple">
<li><p>“Treatment（处理）”是饲料类型 Diet。</p></li>
<li><p>“Effect（效应）”是最终体重 weight_end 的变化。</p></li>
<li><p>“Average” 表示对所有小鸡取平均效果。</p></li>
</ul>
<blockquote>
<div><p>为什么叫“平均”因果效应
•	并不是每只小鸡都增加 22.8 g；
•	有的小鸡可能增重 30 g，有的只 10 g；
•	22.8 g 是总体平均效应。</p>
</div></blockquote>
<p>能否“确定”Diet影响小鸡体重？</p>
<p>因果分析（DoWhy + 反事实）</p>
<ul class="simple">
<li><p>你控制了初始体重 (weight_start)，排除了“原本体重大 → 吃特定饲料 → 更重”的混杂影响。</p></li>
<li><p>在控制后，模型估计的平均因果效应（ATE） ≈  +22 克。
即在同等初始体重条件下，改变饲料类型平均能使小鸡体重增加约 22 克。</p></li>
<li><p>反事实模拟（如果全体都改喂 Diet 3）显示整体体重分布右移。
这提供了“饲料 → 体重”因果影响的证据。</p></li>
</ul>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>潜在问题</strong></p></th>
<th class="head"><p><strong>说明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>分组是否真正随机</strong></p></td>
<td><p>如果实验设计中饲料分配并非完全随机，仍可能有未控制混杂因素（如鸡的品种、性别、健康状况）。</p></td>
</tr>
<tr class="row-odd"><td><p><strong>样本量较小</strong></p></td>
<td><p>每组 9–16 只，估计的置信区间较宽，效应大小存在不确定性。</p></td>
</tr>
<tr class="row-even"><td><p><strong>模型假设线性</strong></p></td>
<td><p>我们假设 weight_end 与 diet、weight_start 呈线性关系，但真实生长曲线可能非线性。</p></td>
</tr>
</tbody>
</table>
</div>
<p>如何描述这个结论？</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">方差分析显示，不同饲料组的最终体重存在显著差异（p &lt; 0.05）。
</span><span data-line="2">进一步的因果分析控制初始体重后，估计饲料对最终体重的平均因果效应为 22.8 克。
</span><span data-line="3">反事实模拟表明，若所有个体改喂 Diet 3，整体体重分布将明显右移。
</span><span data-line="4">因此，在本实验条件下，饲料类型可被视为影响小鸡体重的重要因素。
</span></pre></div>
</div>
</section>
</section>
<section id="id16">
<h2>因果效应差异<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<p>当我们问：</p>
<blockquote>
<div><p>“跑步、游泳、瑜伽，哪种运动减肥效果最好？”</p>
</div></blockquote>
<p>我们其实在问：<strong>不同treatment之间的因果效应是否有差异？</strong></p>
<p>定义上：</p>
<ul class="simple">
<li><p>因果效应（causal effect） = 处理组与对照组的结果之差；</p></li>
<li><p>因果效应差异（treatment effect heterogeneity）= 不同处理之间的效应差。</p></li>
</ul>
<p>如果我们想回答哪种Diet的增重效果最好，可以计算因果效应差异。</p>
<section id="id17">
<h3>代码<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span data-line="2"><span class="c1"># ChickWeight：多处理因果效应分析（ANCOVA）+ Seaborn 可视化（森林图）</span>
</span><span data-line="3"><span class="c1"># 说明：</span>
</span><span data-line="4"><span class="c1"># 1) 以“最终日体重”为结果（weight_final），以“基线体重”为协变量（weight0），Diet 为多处理</span>
</span><span data-line="5"><span class="c1"># 2) 用 ANCOVA 估计相对于 Diet 1 的平均因果效应（ATE）及 95% CI、p 值</span>
</span><span data-line="6"><span class="c1"># 3) 使用 Seaborn 绘制“因果效应差异森林图”（ATE ± 95% CI）</span>
</span><span data-line="7"><span class="c1"># 4) 可选：拟合混合效应模型（全时序），绘制各 Diet 的预测生长曲线（matplotlib）</span>
</span><span data-line="8">
</span><span data-line="9"><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span data-line="10"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="11"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="12"><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span data-line="13"><span class="kn">import</span><span class="w"> </span><span class="nn">statsmodels.api</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sm</span>
</span><span data-line="14"><span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.formula.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">ols</span><span class="p">,</span> <span class="n">mixedlm</span>
</span><span data-line="15">
</span><span data-line="16"><span class="c1"># ---------------------------</span>
</span><span data-line="17"><span class="c1"># 0) 读取数据</span>
</span><span data-line="18"><span class="c1"># ---------------------------</span>
</span><span data-line="19"><span class="c1"># 若你的文件不在当前目录，请修改文件名为实际路径</span>
</span><span data-line="20"><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;chickweight.csv&quot;</span><span class="p">)</span>
</span><span data-line="21">
</span><span data-line="22"><span class="c1"># ---------------------------</span>
</span><span data-line="23"><span class="c1"># 1) 构造面板：基线体重、最终体重与增量</span>
</span><span data-line="24"><span class="c1"># ---------------------------</span>
</span><span data-line="25"><span class="n">baseline</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][[</span><span class="s2">&quot;chick&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;weight0&quot;</span><span class="p">})</span>
</span><span data-line="26"><span class="n">final_idx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;chick&quot;</span><span class="p">)[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>
</span><span data-line="27"><span class="n">final_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">final_idx</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;chick&quot;</span><span class="p">,</span> <span class="s2">&quot;diet&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span data-line="28">    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="s2">&quot;weight_final&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;time_final&quot;</span><span class="p">}</span>
</span><span data-line="29"><span class="p">)</span>
</span><span data-line="30"><span class="n">panel</span> <span class="o">=</span> <span class="n">final_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">baseline</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;chick&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span data-line="31"><span class="n">panel</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s2">&quot;weight_final&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">panel</span><span class="p">[</span><span class="s2">&quot;weight0&quot;</span><span class="p">]</span>
</span><span data-line="32"><span class="n">panel</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span data-line="33">
</span><span data-line="34"><span class="c1"># ---------------------------</span>
</span><span data-line="35"><span class="c1"># 2) 描述性统计（可选）</span>
</span><span data-line="36"><span class="c1"># ---------------------------</span>
</span><span data-line="37"><span class="n">desc</span> <span class="o">=</span> <span class="n">panel</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;diet&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span><span data-line="38">    <span class="n">n</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;chick&quot;</span><span class="p">,</span> <span class="s2">&quot;count&quot;</span><span class="p">),</span>
</span><span data-line="39">    <span class="n">baseline_mean</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;weight0&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
</span><span data-line="40">    <span class="n">final_mean</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;weight_final&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
</span><span data-line="41">    <span class="n">gain_mean</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;gain&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">),</span>
</span><span data-line="42">    <span class="n">final_std</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;weight_final&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">),</span>
</span><span data-line="43">    <span class="n">gain_std</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;gain&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">),</span>
</span><span data-line="44"><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="45"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Descriptives] ChickWeight by Diet&quot;</span><span class="p">)</span>
</span><span data-line="46"><span class="nb">print</span><span class="p">(</span><span class="n">desc</span><span class="p">)</span>
</span><span data-line="47">
</span><span data-line="48"><span class="c1"># ---------------------------</span>
</span><span data-line="49"><span class="c1"># 3) 因果分析：ANCOVA（weight_final ~ C(diet) + weight0）</span>
</span><span data-line="50"><span class="c1">#    Diet 1 为基类，C(diet)[T.k] 系数 ≈ ATE(k,1)</span>
</span><span data-line="51"><span class="c1"># ---------------------------</span>
</span><span data-line="52"><span class="n">ancova</span> <span class="o">=</span> <span class="n">ols</span><span class="p">(</span><span class="s2">&quot;weight_final ~ C(diet) + weight0&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">panel</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</span><span data-line="53"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[ANCOVA Summary]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="54"><span class="nb">print</span><span class="p">(</span><span class="n">ancova</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</span><span data-line="55">
</span><span data-line="56"><span class="c1"># 3.1 在平均基线体重处，各 diet 的调整后均值与 95% CI</span>
</span><span data-line="57"><span class="n">w0_bar</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s2">&quot;weight0&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span data-line="58"><span class="n">adj_means</span><span class="p">,</span> <span class="n">adj_ci</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>
</span><span data-line="59"><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
</span><span data-line="60">    <span class="n">X</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Intercept&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;weight0&quot;</span><span class="p">:</span> <span class="n">w0_bar</span><span class="p">}</span>
</span><span data-line="61">    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
</span><span data-line="62">        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="63">            <span class="k">continue</span>
</span><span data-line="64">        <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;C(diet)[T.</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span data-line="65">        <span class="n">X</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="n">k</span> <span class="k">else</span> <span class="mf">0.0</span>
</span><span data-line="66">    <span class="n">x_vec</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ancova</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">index</span><span class="p">})</span>
</span><span data-line="67">    <span class="n">mu</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_vec</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">ancova</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</span><span data-line="68">    <span class="n">V</span> <span class="o">=</span> <span class="n">ancova</span><span class="o">.</span><span class="n">cov_params</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
</span><span data-line="69">    <span class="n">se</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_vec</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">x_vec</span><span class="o">.</span><span class="n">values</span><span class="p">))))</span>
</span><span data-line="70">    <span class="n">z</span> <span class="o">=</span> <span class="mf">1.96</span>
</span><span data-line="71">    <span class="n">adj_means</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">mu</span>
</span><span data-line="72">    <span class="n">adj_ci</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu</span> <span class="o">-</span> <span class="n">z</span> <span class="o">*</span> <span class="n">se</span><span class="p">,</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">z</span> <span class="o">*</span> <span class="n">se</span><span class="p">)</span>
</span><span data-line="73">
</span><span data-line="74"><span class="n">adj_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
</span><span data-line="75">    <span class="s2">&quot;diet&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">adj_means</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
</span><span data-line="76">    <span class="s2">&quot;adj_mean&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">adj_means</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">adj_means</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
</span><span data-line="77">    <span class="s2">&quot;ci_low&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">adj_ci</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">adj_ci</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
</span><span data-line="78">    <span class="s2">&quot;ci_high&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">adj_ci</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">adj_ci</span><span class="o">.</span><span class="n">keys</span><span class="p">())],</span>
</span><span data-line="79"><span class="p">})</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;diet&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="80"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Adjusted Means at mean(baseline)] Final Weight by Diet (95% CI)&quot;</span><span class="p">)</span>
</span><span data-line="81"><span class="nb">print</span><span class="p">(</span><span class="n">adj_df</span><span class="p">)</span>
</span><span data-line="82">
</span><span data-line="83"><span class="c1"># 3.2 相对 Diet 1 的两两因果效应差异（ATE 与 95% CI、p 值）</span>
</span><span data-line="84"><span class="n">pairwise</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="85"><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
</span><span data-line="86">    <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="87">        <span class="k">continue</span>
</span><span data-line="88">    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;C(diet)[T.</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">]&quot;</span>
</span><span data-line="89">    <span class="n">est</span> <span class="o">=</span> <span class="n">ancova</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="90">    <span class="n">ci_low</span><span class="p">,</span> <span class="n">ci_high</span> <span class="o">=</span> <span class="n">ancova</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="91">    <span class="n">p</span> <span class="o">=</span> <span class="n">ancova</span><span class="o">.</span><span class="n">pvalues</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span data-line="92">    <span class="n">pairwise</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span data-line="93">        <span class="s2">&quot;Comparison&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Diet </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> - Diet 1&quot;</span><span class="p">,</span>
</span><span data-line="94">        <span class="s2">&quot;ATE_est&quot;</span><span class="p">:</span> <span class="n">est</span><span class="p">,</span>
</span><span data-line="95">        <span class="s2">&quot;CI_low&quot;</span><span class="p">:</span> <span class="n">ci_low</span><span class="p">,</span>
</span><span data-line="96">        <span class="s2">&quot;CI_high&quot;</span><span class="p">:</span> <span class="n">ci_high</span><span class="p">,</span>
</span><span data-line="97">        <span class="s2">&quot;pvalue&quot;</span><span class="p">:</span> <span class="n">p</span>
</span><span data-line="98">    <span class="p">})</span>
</span><span data-line="99"><span class="n">ate_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pairwise</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="100"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Pairwise causal effect differences (ATE vs Diet 1)]&quot;</span><span class="p">)</span>
</span><span data-line="101"><span class="nb">print</span><span class="p">(</span><span class="n">ate_df</span><span class="p">)</span>
</span><span data-line="102">
</span><span data-line="103"><span class="c1"># ---------------------------</span>
</span><span data-line="104"><span class="c1"># 4) Seaborn：因果效应差异“森林图”</span>
</span><span data-line="105"><span class="c1"># ---------------------------</span>
</span><span data-line="106"><span class="c1"># 误差条宽度（用于绘制 95% CI）</span>
</span><span data-line="107"><span class="n">ate_df</span><span class="p">[</span><span class="s2">&quot;err_low&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">ate_df</span><span class="p">[</span><span class="s2">&quot;ATE_est&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ate_df</span><span class="p">[</span><span class="s2">&quot;CI_low&quot;</span><span class="p">]</span>
</span><span data-line="108"><span class="n">ate_df</span><span class="p">[</span><span class="s2">&quot;err_high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ate_df</span><span class="p">[</span><span class="s2">&quot;CI_high&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ate_df</span><span class="p">[</span><span class="s2">&quot;ATE_est&quot;</span><span class="p">]</span>
</span><span data-line="109">
</span><span data-line="110"><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
</span><span data-line="111"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span data-line="112"><span class="c1"># 点图（估计值）</span>
</span><span data-line="113"><span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span>
</span><span data-line="114">    <span class="n">data</span><span class="o">=</span><span class="n">ate_df</span><span class="p">,</span>
</span><span data-line="115">    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ATE_est&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Comparison&quot;</span><span class="p">,</span>
</span><span data-line="116">    <span class="n">join</span><span class="o">=</span><span class="kc">False</span>
</span><span data-line="117"><span class="p">)</span>
</span><span data-line="118"><span class="c1"># 水平误差条（95% CI）</span>
</span><span data-line="119"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">ate_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
</span><span data-line="120">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;CI_low&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;CI_high&quot;</span><span class="p">]],</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="121">
</span><span data-line="122"><span class="c1"># 参考线 x=0</span>
</span><span data-line="123"><span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="124">
</span><span data-line="125"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Causal Effect Differences vs Diet 1 (ANCOVA, 95% CI)&quot;</span><span class="p">)</span>
</span><span data-line="126"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Average Treatment Effect (g)&quot;</span><span class="p">)</span>
</span><span data-line="127"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Comparison&quot;</span><span class="p">)</span>
</span><span data-line="128"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span data-line="129"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span data-line="130">
</span><span data-line="131"><span class="c1"># ---------------------------</span>
</span><span data-line="132"><span class="c1"># 5) （可选）混合效应模型：全时序生长曲线</span>
</span><span data-line="133"><span class="c1">#    weight ~ time * C(diet) + (1 | chick)</span>
</span><span data-line="134"><span class="c1"># ---------------------------</span>
</span><span data-line="135"><span class="n">df_me</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="136"><span class="n">df_me</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_me</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</span><span data-line="137">
</span><span data-line="138"><span class="n">mix</span> <span class="o">=</span> <span class="n">mixedlm</span><span class="p">(</span><span class="s2">&quot;weight ~ time * C(diet)&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_me</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="n">df_me</span><span class="p">[</span><span class="s2">&quot;chick&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">reml</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="139"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[Mixed Effects: fixed effects]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="140"><span class="nb">print</span><span class="p">(</span><span class="n">mix</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</span><span data-line="141">
</span><span data-line="142"><span class="c1"># 预测各 diet 的生长曲线（固定效应）</span>
</span><span data-line="143"><span class="n">time_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">12</span><span class="p">)</span>
</span><span data-line="144"><span class="n">pred_rows</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="145"><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df_me</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
</span><span data-line="146">    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time_grid</span><span class="p">:</span>
</span><span data-line="147">        <span class="n">Xrow</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="s2">&quot;diet&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="n">d</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="n">df_me</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span><span class="p">)})</span>
</span><span data-line="148">        <span class="n">yhat</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">mix</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xrow</span><span class="p">))</span>
</span><span data-line="149">        <span class="n">pred_rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;diet&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span> <span class="s2">&quot;pred_weight&quot;</span><span class="p">:</span> <span class="n">yhat</span><span class="p">})</span>
</span><span data-line="150"><span class="n">pred_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred_rows</span><span class="p">)</span>
</span><span data-line="151">
</span><span data-line="152"><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span><span data-line="153"><span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pred_df</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
</span><span data-line="154">    <span class="n">sub</span> <span class="o">=</span> <span class="n">pred_df</span><span class="p">[</span><span class="n">pred_df</span><span class="p">[</span><span class="s2">&quot;diet&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span><span class="p">]</span>
</span><span data-line="155">    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sub</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">],</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;pred_weight&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Diet </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="156"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predicted Growth Curves by Diet (Mixed Effects)&quot;</span><span class="p">)</span>
</span><span data-line="157"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (days)&quot;</span><span class="p">)</span>
</span><span data-line="158"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Predicted Weight (g)&quot;</span><span class="p">)</span>
</span><span data-line="159"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span data-line="160"><span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span data-line="161"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span data-line="162"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span data-line="163">
</span><span data-line="164"><span class="c1"># ---------------------------</span>
</span><span data-line="165"><span class="c1"># 6) 可选：保存模型摘要到当前目录</span>
</span><span data-line="166"><span class="c1"># ---------------------------</span>
</span><span data-line="167"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;ancova_summary.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span data-line="168">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ancova</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">as_text</span><span class="p">())</span>
</span><span data-line="169"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;mixedlm_summary.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span data-line="170">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mix</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">as_text</span><span class="p">())</span>
</span><span data-line="171"><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Saved: ancova_summary.txt, mixedlm_summary.txt&quot;</span><span class="p">)</span>
</span></pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="p">[</span><span class="n">Descriptives</span><span class="p">]</span> <span class="n">ChickWeight</span> <span class="n">by</span> <span class="n">Diet</span>
</span><span data-line="2">       <span class="n">n</span>  <span class="n">baseline_mean</span>  <span class="n">final_mean</span>  <span class="n">gain_mean</span>  <span class="n">final_std</span>  <span class="n">gain_std</span>
</span><span data-line="3"><span class="n">diet</span>                                                               
</span><span data-line="4"><span class="mi">1</span>     <span class="mi">20</span>           <span class="mf">41.4</span>       <span class="mf">156.3</span>      <span class="mf">114.9</span>      <span class="mf">69.96</span>     <span class="mf">69.78</span>
</span><span data-line="5"><span class="mi">2</span>     <span class="mi">10</span>           <span class="mf">40.7</span>       <span class="mf">214.7</span>      <span class="mf">174.0</span>      <span class="mf">78.14</span>     <span class="mf">78.99</span>
</span><span data-line="6"><span class="mi">3</span>     <span class="mi">10</span>           <span class="mf">40.8</span>       <span class="mf">270.3</span>      <span class="mf">229.5</span>      <span class="mf">71.62</span>     <span class="mf">71.11</span>
</span><span data-line="7"><span class="mi">4</span>     <span class="mi">10</span>           <span class="mf">41.0</span>       <span class="mf">229.3</span>      <span class="mf">188.3</span>      <span class="mf">50.27</span>     <span class="mf">50.91</span>
</span><span data-line="8">
</span><span data-line="9"><span class="p">[</span><span class="n">ANCOVA</span> <span class="n">Summary</span><span class="p">]</span>
</span><span data-line="10">
</span><span data-line="11">                            <span class="n">OLS</span> <span class="n">Regression</span> <span class="n">Results</span>                            
</span><span data-line="12"><span class="o">==============================================================================</span>
</span><span data-line="13"><span class="n">Dep</span><span class="o">.</span> <span class="n">Variable</span><span class="p">:</span>           <span class="n">weight_final</span>   <span class="n">R</span><span class="o">-</span><span class="n">squared</span><span class="p">:</span>                       <span class="mf">0.313</span>
</span><span data-line="14"><span class="n">Model</span><span class="p">:</span>                            <span class="n">OLS</span>   <span class="n">Adj</span><span class="o">.</span> <span class="n">R</span><span class="o">-</span><span class="n">squared</span><span class="p">:</span>                  <span class="mf">0.252</span>
</span><span data-line="15"><span class="n">Method</span><span class="p">:</span>                 <span class="n">Least</span> <span class="n">Squares</span>   <span class="n">F</span><span class="o">-</span><span class="n">statistic</span><span class="p">:</span>                     <span class="mf">5.135</span>
</span><span data-line="16"><span class="n">Date</span><span class="p">:</span>                <span class="n">Fri</span><span class="p">,</span> <span class="mi">31</span> <span class="n">Oct</span> <span class="mi">2025</span>   <span class="n">Prob</span> <span class="p">(</span><span class="n">F</span><span class="o">-</span><span class="n">statistic</span><span class="p">):</span>            <span class="mf">0.00171</span>
</span><span data-line="17"><span class="n">Time</span><span class="p">:</span>                        <span class="mi">20</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">59</span>   <span class="n">Log</span><span class="o">-</span><span class="n">Likelihood</span><span class="p">:</span>                <span class="o">-</span><span class="mf">280.16</span>
</span><span data-line="18"><span class="n">No</span><span class="o">.</span> <span class="n">Observations</span><span class="p">:</span>                  <span class="mi">50</span>   <span class="n">AIC</span><span class="p">:</span>                             <span class="mf">570.3</span>
</span><span data-line="19"><span class="n">Df</span> <span class="n">Residuals</span><span class="p">:</span>                      <span class="mi">45</span>   <span class="n">BIC</span><span class="p">:</span>                             <span class="mf">579.9</span>
</span><span data-line="20"><span class="n">Df</span> <span class="n">Model</span><span class="p">:</span>                           <span class="mi">4</span>                                         
</span><span data-line="21"><span class="n">Covariance</span> <span class="n">Type</span><span class="p">:</span>            <span class="n">nonrobust</span>                                         
</span><span data-line="22"><span class="o">================================================================================</span>
</span><span data-line="23">                   <span class="n">coef</span>    <span class="n">std</span> <span class="n">err</span>          <span class="n">t</span>      <span class="n">P</span><span class="o">&gt;|</span><span class="n">t</span><span class="o">|</span>      <span class="p">[</span><span class="mf">0.025</span>      <span class="mf">0.975</span><span class="p">]</span>
</span><span data-line="24"><span class="o">--------------------------------------------------------------------------------</span>
</span><span data-line="25"><span class="o">...</span>
</span><span data-line="26">        <span class="n">Comparison</span>  <span class="n">ATE_est</span>  <span class="n">CI_low</span>  <span class="n">CI_high</span>  <span class="n">pvalue</span>
</span><span data-line="27"><span class="mi">0</span>  <span class="n">Diet</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">Diet</span> <span class="mi">1</span>   <span class="mf">54.945</span>  <span class="o">-</span><span class="mf">0.515</span>  <span class="mf">110.406</span>   <span class="mf">0.052</span>
</span><span data-line="28"><span class="mi">1</span>  <span class="n">Diet</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">Diet</span> <span class="mi">1</span>  <span class="mf">111.039</span>  <span class="mf">55.969</span>  <span class="mf">166.109</span>   <span class="mf">0.000</span>
</span><span data-line="29"><span class="mi">2</span>  <span class="n">Diet</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">Diet</span> <span class="mi">1</span>   <span class="mf">71.026</span>  <span class="mf">16.562</span>  <span class="mf">125.490</span>   <span class="mf">0.012</span>
</span></pre></div>
</div>
<p><img alt="ATE-dif" src="../_images/ATE-dif.png" /></p>
<p>森林图的结构</p>
<ul class="simple">
<li><p><strong>横轴（X 轴）</strong>：Average Treatment Effect (g)，表示相对于 Diet 1 的平均体重差异。</p>
<ul>
<li><p>越往右 → 最终体重越高（比 Diet 1 更有效）。</p></li>
<li><p>虚线 x = 0 → “无差异”基线。</p></li>
<li><p>若置信区间（水平线）跨过 0 → 差异不显著。</p></li>
</ul>
</li>
<li><p><strong>纵轴（Y 轴）</strong>：三种比较</p>
<ul>
<li><p>Diet 2 – Diet 1</p></li>
<li><p>Diet 3 – Diet 1</p></li>
<li><p>Diet 4 – Diet 1</p></li>
</ul>
</li>
<li><p><strong>圆点</strong>：估计的 ATE 值。</p></li>
<li><p><strong>水平线段</strong>：95 % 置信区间（CI）。
表示在统计上我们有 95 % 的把握，真实效应位于这条线的范围内。</p></li>
</ul>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>比较</strong></p></th>
<th class="head"><p><strong>ATE (中点)</strong></p></th>
<th class="head"><p><strong>CI 范围</strong></p></th>
<th class="head"><p><strong>结论</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Diet 2 – Diet 1</strong></p></td>
<td><p>约 +55 g</p></td>
<td><p>−0.5 ～ 110 g</p></td>
<td><p>差异“边缘显著”；可能略优于 Diet 1，但也可能无差异（CI 几乎触 0）</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Diet 3 – Diet 1</strong></p></td>
<td><p>约 +111 g</p></td>
<td><p>56 ～ 166 g</p></td>
<td><p>明显优于 Diet 1；置信区间完全在 0 右侧，且距离远，说明显著提升体重</p></td>
</tr>
<tr class="row-even"><td><p><strong>Diet 4 – Diet 1</strong></p></td>
<td><p>约 +71 g</p></td>
<td><p>17 ～ 125 g</p></td>
<td><p>也显著优于 Diet 1 （CI 不跨 0）</p></td>
</tr>
</tbody>
</table>
</div>
<p>结论：</p>
<ol class="arabic simple">
<li><p><strong>Diet 3 效果最强</strong>：平均比 Diet 1 重 约 110 克，差异高度显著。</p></li>
<li><p><strong>Diet 4 次之</strong>：平均 +70 克，也有显著提升。</p></li>
<li><p><strong>Diet 2 轻微优于 Diet 1</strong>，但置信区间几乎包含 0，统计上只是接近显著。</p></li>
<li><p>所有线段都在 0 右侧 → 饮食方案总体上都能增加体重，只是效果强弱不同。</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">
</span><span data-line="2"><span class="p">[</span><span class="n">Mixed</span> <span class="n">Effects</span><span class="p">:</span> <span class="n">fixed</span> <span class="n">effects</span><span class="p">]</span>
</span><span data-line="3">
</span><span data-line="4">            <span class="n">Mixed</span> <span class="n">Linear</span> <span class="n">Model</span> <span class="n">Regression</span> <span class="n">Results</span>
</span><span data-line="5"><span class="o">==============================================================</span>
</span><span data-line="6"><span class="n">Model</span><span class="p">:</span>              <span class="n">MixedLM</span>   <span class="n">Dependent</span> <span class="n">Variable</span><span class="p">:</span>   <span class="n">weight</span>    
</span><span data-line="7"><span class="n">No</span><span class="o">.</span> <span class="n">Observations</span><span class="p">:</span>   <span class="mi">578</span>       <span class="n">Method</span><span class="p">:</span>               <span class="n">REML</span>      
</span><span data-line="8"><span class="n">No</span><span class="o">.</span> <span class="n">Groups</span><span class="p">:</span>         <span class="mi">50</span>        <span class="n">Scale</span><span class="p">:</span>                <span class="mf">643.3133</span>  
</span><span data-line="9"><span class="n">Min</span><span class="o">.</span> <span class="n">group</span> <span class="n">size</span><span class="p">:</span>    <span class="mi">2</span>         <span class="n">Log</span><span class="o">-</span><span class="n">Likelihood</span><span class="p">:</span>       <span class="o">-</span><span class="mf">2733.4523</span>
</span><span data-line="10"><span class="n">Max</span><span class="o">.</span> <span class="n">group</span> <span class="n">size</span><span class="p">:</span>    <span class="mi">12</span>        <span class="n">Converged</span><span class="p">:</span>            <span class="n">Yes</span>       
</span><span data-line="11"><span class="n">Mean</span> <span class="n">group</span> <span class="n">size</span><span class="p">:</span>    <span class="mf">11.6</span>                                      
</span><span data-line="12"><span class="o">--------------------------------------------------------------</span>
</span><span data-line="13">                   <span class="n">Coef</span><span class="o">.</span>  <span class="n">Std</span><span class="o">.</span><span class="n">Err</span><span class="o">.</span>   <span class="n">z</span>    <span class="n">P</span><span class="o">&gt;|</span><span class="n">z</span><span class="o">|</span>  <span class="p">[</span><span class="mf">0.025</span> <span class="mf">0.975</span><span class="p">]</span>
</span><span data-line="14"><span class="o">--------------------------------------------------------------</span>
</span><span data-line="15"><span class="n">Intercept</span>          <span class="mf">31.514</span>    <span class="mf">6.116</span>  <span class="mf">5.153</span> <span class="mf">0.000</span>  <span class="mf">19.527</span> <span class="mf">43.502</span>
</span><span data-line="16"><span class="n">C</span><span class="p">(</span><span class="n">diet</span><span class="p">)[</span><span class="n">T</span><span class="mf">.2</span><span class="p">]</span>       <span class="o">-</span><span class="mf">2.881</span>   <span class="mf">10.547</span> <span class="o">-</span><span class="mf">0.273</span> <span class="mf">0.785</span> <span class="o">-</span><span class="mf">23.553</span> <span class="mf">17.792</span>
</span><span data-line="17"><span class="n">C</span><span class="p">(</span><span class="n">diet</span><span class="p">)[</span><span class="n">T</span><span class="mf">.3</span><span class="p">]</span>      <span class="o">-</span><span class="mf">13.264</span>   <span class="mf">10.547</span> <span class="o">-</span><span class="mf">1.258</span> <span class="mf">0.209</span> <span class="o">-</span><span class="mf">33.937</span>  <span class="mf">7.409</span>
</span><span data-line="18"><span class="n">C</span><span class="p">(</span><span class="n">diet</span><span class="p">)[</span><span class="n">T</span><span class="mf">.4</span><span class="p">]</span>       <span class="o">-</span><span class="mf">0.402</span>   <span class="mf">10.556</span> <span class="o">-</span><span class="mf">0.038</span> <span class="mf">0.970</span> <span class="o">-</span><span class="mf">21.091</span> <span class="mf">20.288</span>
</span><span data-line="19"><span class="n">time</span>                <span class="mf">6.711</span>    <span class="mf">0.258</span> <span class="mf">25.972</span> <span class="mf">0.000</span>   <span class="mf">6.205</span>  <span class="mf">7.218</span>
</span><span data-line="20"><span class="n">time</span><span class="p">:</span><span class="n">C</span><span class="p">(</span><span class="n">diet</span><span class="p">)[</span><span class="n">T</span><span class="mf">.2</span><span class="p">]</span>   <span class="mf">1.898</span>    <span class="mf">0.428</span>  <span class="mf">4.429</span> <span class="mf">0.000</span>   <span class="mf">1.058</span>  <span class="mf">2.737</span>
</span><span data-line="21"><span class="n">time</span><span class="p">:</span><span class="n">C</span><span class="p">(</span><span class="n">diet</span><span class="p">)[</span><span class="n">T</span><span class="mf">.3</span><span class="p">]</span>   <span class="mf">4.711</span>    <span class="mf">0.428</span> <span class="mf">10.997</span> <span class="mf">0.000</span>   <span class="mf">3.872</span>  <span class="mf">5.551</span>
</span><span data-line="22"><span class="n">time</span><span class="p">:</span><span class="n">C</span><span class="p">(</span><span class="n">diet</span><span class="p">)[</span><span class="n">T</span><span class="mf">.4</span><span class="p">]</span>   <span class="mf">2.951</span>    <span class="mf">0.434</span>  <span class="mf">6.799</span> <span class="mf">0.000</span>   <span class="mf">2.100</span>  <span class="mf">3.801</span>
</span><span data-line="23"><span class="n">Group</span> <span class="n">Var</span>         <span class="mf">545.659</span>    <span class="mf">5.149</span>                            
</span><span data-line="24"><span class="o">==============================================================</span>
</span></pre></div>
</div>
<p><img alt="mixed-effects-line" src="../_images/mixed-effects-line.png" /></p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>图类型</strong></p></th>
<th class="head"><p><strong>数据来源</strong></p></th>
<th class="head"><p><strong>含义</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>平均生长曲线图</strong></p></td>
<td><p>实际观测均值（平均线+置信带）</p></td>
<td><p>原始实验数据的趋势，可见真实波动</p></td>
</tr>
<tr class="row-odd"><td><p><strong>混合效应模型预测图</strong></p></td>
<td><p>模型拟合值（固定效应预测）</p></td>
<td><p>理论平均趋势，平滑、去噪后反映“真实效应”</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>

        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>回到顶部</span>
</button><div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="CA.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>上一章</span><div class="title">相关性分析</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="PCA.html">
      <div class="page-info">
        <span>下一章</span>
        <div class="title">主成分分析</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Zhijun Gao</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=c16fcb61"></script>
      <script src="../_static/doctools.js?v=9a2dae69"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../_static/copybutton.js?v=f281be69"></script>
      <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-YSF8MXKHBM"></script>
      <script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-YSF8MXKHBM');
</script>
      <script src="../_static/shibuya.js?v=e730760c"></script></body>
</html>